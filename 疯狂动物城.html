<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç–¯ç‹‚åŠ¨ç‰©åŸï¼šç‹ç‰Œç†è´¢å¸ˆ</title>
    <style>
        :root {
            --p1-color: #e65100; /* å°¼å…‹æ©™ */
            --p2-color: #1e88e5; /* æœ±è¿ªè“ */
            --font-main: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            --primary-btn: linear-gradient(to bottom, #29b6f6, #0288d1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            /* åŠ¨ç‰©åŸæ˜¼å¤œäº¤æ›¿æ„Ÿ */
            background: linear-gradient(160deg, #b2dfdb 0%, #3f51b5 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            width: 98vw;
            max-width: 1150px;
            height: 98vh; 
            max-height: 850px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: grid;
            grid-template-columns: 260px 1fr;
            padding: 15px;
            gap: 15px;
            border: 6px solid #fff;
        }

        /* --- å·¦ä¾§æ§åˆ¶åŒº --- */
        #control-panel {
            background: #fff;
            padding: 10px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: 100%;
            border: 2px solid #4dd0e1;
            overflow: hidden;
        }

        .game-status {
            background: #009688; color: #fff; padding: 10px; border-radius: 10px; font-size: 13px; flex-shrink: 0;
        }
        .progress-bar-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.3); border-radius: 3px; margin-top: 5px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: #ffd700; width: 0%; transition: width 0.5s; }

        .player-card {
            padding: 8px; border-radius: 10px; border: 2px solid #e0f7fa; background: #fff; transition: all 0.3s; flex-shrink: 0; position: relative;
        }
        .player-card.active {
            border-color: #ff9800; background-color: #fff3e0; transform: scale(1.02); box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        .money-display { font-size: 22px; color: #006064; font-weight: bold; font-family: monospace; display: block; margin-top: 2px; }

        /* å¼€å…³æ ·å¼ */
        .math-toggle-row { display: flex; align-items: center; justify-content: space-between; margin-top: 5px; font-size: 11px; color: #666; background: #e0f2f1; padding: 4px 8px; border-radius: 15px; }
        .switch { position: relative; display: inline-block; width: 34px; height: 18px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 18px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #1e88e5; }
        input:checked + .slider:before { transform: translateX(16px); }

        #log-box {
            flex-grow: 1; overflow-y: auto; font-size: 12px; border-top: 1px dashed #ccc; padding: 5px 0; color: #555; line-height: 1.4;
        }

        #action-area {
            height: 140px; position: relative; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; flex-shrink: 0; perspective: 600px;
        }

        /* 3Déª°å­ */
        .cube-wrapper { width: 50px; height: 50px; position: absolute; top: 15px; transform-style: preserve-3d; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1.2s ease-out; }
        .cube-face { position: absolute; width: 50px; height: 50px; background: #fff; border: 2px solid #ff9800; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; color: #e65100; box-shadow: inset 0 0 5px rgba(0,0,0,0.1); }
        .face-1 { transform: rotateY(0deg) translateZ(25px); } .face-2 { transform: rotateY(90deg) translateZ(25px); }
        .face-3 { transform: rotateX(-90deg) translateZ(25px); } .face-4 { transform: rotateX(90deg) translateZ(25px); }
        .face-5 { transform: rotateY(-90deg) translateZ(25px); } .face-6 { transform: rotateY(180deg) translateZ(25px); }
        .face-1::after { content: "ğŸ¥•"; } .face-2::after { content: "2"; } .face-3::after { content: "3"; } 
        .face-4::after { content: "4"; } .face-5::after { content: "5"; } .face-6::after { content: "6"; }

        .roll-btn {
            background: var(--primary-btn); color: white; border: none; padding: 12px 0; width: 100%; font-size: 18px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #0277bd; margin-top: 70px; transition: transform 0.1s;
        }
        .roll-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #0277bd; }
        .roll-btn:disabled { background: #cfd8dc; cursor: not-allowed; box-shadow: none; transform: translateY(3px); }

        /* --- å³ä¾§æ£‹ç›˜ (6x6 ç½‘æ ¼, 32æ ¼è·¯å¾„, ä¸­é—´ç©º4æ ¼) --- */
        #board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 12px;
            position: relative;
            padding: 20px;
            background: #e0f7fa;
            border-radius: 20px;
            border: 4px solid #4dd0e1;
            height: 100%;
            box-sizing: border-box;
        }

        .cell {
            background: #fff; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 11px; position: relative; text-align: center; font-weight: bold; box-shadow: 0 4px 0 #b0bec5; padding: 2px; overflow: hidden; border: 1px solid #cfd8dc; z-index: 1; transition: transform 0.2s;
        }
        
        .cell::after {
            content: attr(data-arrow); position: absolute; right: 4px; bottom: 2px; font-size: 12px; color: rgba(0,0,0,0.15); font-weight: bold;
        }

        .cell-icon { font-size: 28px; margin-bottom: 2px; line-height: 1; }
        .cell-name { font-size: 11px; color: #37474f; width: 95%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .cell-info { font-size: 10px; color: #78909c; transform: scale(0.9); }

        /* æ ¼å­ç±»å‹ */
        .t-start { background: #dcedc8; border-bottom: 4px solid #8bc34a; } 
        .t-city  { border-bottom: 4px solid #29b6f6; } 
        .t-bad   { background: #ffccbc; border-bottom: 4px solid #ff7043; } 
        .t-luck  { background: #fff9c4; border-bottom: 4px solid #fdd835; } 
        .t-trap  { background: #546e7a; color: #fff; border-bottom: 4px solid #263238; } 
        .t-trap .cell-name { color: #fff; } .t-trap .cell-info { color: #cfd8dc; }
        .t-fun   { background: #ffe0b2; border-bottom: 4px solid #ffa726; } 
        .t-quiz  { background: #e1bee7; border-bottom: 4px solid #ab47bc; } 
        .t-school{ background: #b2dfdb; border-bottom: 4px solid #26a69a; }
        .t-super { background: #ce93d8; border-bottom: 4px solid #8e24aa; } 

        /* ä¸­é—´ç•™ç™½åŒºåŸŸ (2x2æ ¼) */
        .center-area {
            grid-column: 3 / 5;
            grid-row: 3 / 5;
            background: linear-gradient(135deg, #ffffff 0%, #e0f2f1 100%);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #006064;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05), 0 0 0 8px #80deea;
            z-index: 0;
            padding: 10px;
        }
        .center-icon { font-size: 40px; margin-bottom: 5px; animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }

        /* æ£‹å­ */
        .token-container {
            width: 40px; height: 50px; position: absolute; z-index: 20; transition: top 0.3s ease, left 0.3s ease; pointer-events: none; display: flex; justify-content: center; align-items: flex-end;
        }
        .character-sprite { font-size: 42px; line-height: 1; filter: drop-shadow(0 3px 2px rgba(0,0,0,0.3)); transform-origin: bottom center; transition: transform 0.2s; }
        .walking .character-sprite { animation: bounce 0.3s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* --- å¼¹çª— --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal-box { background: #fff; padding: 25px; border-radius: 20px; width: 380px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .btn-main { background: var(--primary-btn); color: white; width: 100%; padding: 12px; border:none; border-radius: 10px; font-size: 16px; cursor: pointer; font-weight: bold; margin-top: 15px; }
        
        .start-option { background: #f1f8e9; border: 2px solid #fff; padding: 12px; margin: 8px 0; border-radius: 10px; cursor: pointer; text-align: left; display: flex; justify-content: space-between; align-items: center; }
        .start-option.selected { border-color: #ff9800; background: #fff3e0; }
        .custom-input { width: 60px; padding: 5px; border: 1px solid #ccc; border-radius: 5px; text-align: center; color: #e65100; pointer-events: auto; }

        .math-eq { font-size: 32px; font-weight: bold; color: #006064; margin: 15px 0; font-family: 'Verdana'; }
        .math-input { font-size: 24px; padding: 8px; width: 120px; text-align: center; border: 3px solid #26c6da; border-radius: 8px; outline: none; }
        
        .quiz-btn { display: block; width: 100%; padding: 10px; margin: 8px 0; background: #f5f5f5; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; text-align: left; font-size: 14px; }
        .quiz-btn:hover { background: #e0f7fa; border-color: #26c6da; }

        .trade-info { background: #e0f2f1; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: left; border: 1px solid #b2dfdb; }
        input[type="range"] { width: 100%; margin: 15px 0; accent-color: #ff9800; cursor: pointer; }
        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .btn-opt { padding: 8px; font-size: 12px; border: none; border-radius: 6px; cursor: pointer; background: #cfd8dc; }
        .btn-opt:hover { background: #b0bec5; }
        
        .catbus-btn { background: #fff9c4; border: 2px solid #fbc02d; padding: 10px; margin: 8px 0; border-radius: 10px; cursor: pointer; text-align: left; display: flex; align-items: center; width: 100%; transition: 0.2s; }
        .catbus-btn:hover { transform: scale(1.02); background: #fff59d; }
        .catbus-icon { font-size: 24px; margin-right: 10px; }

        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

<div id="game-container">
    <div id="control-panel">
        <div class="game-status">
            <div style="display:flex; justify-content:space-between;"><span>ğŸ¯ ç›®æ ‡: <span id="goal-text">1000</span></span><span id="turn-text">R: 1</span></div>
            <div class="progress-bar-bg" title="P1"><div id="p1-progress" class="progress-bar-fill" style="background:#e65100"></div></div>
            <div class="progress-bar-bg" title="P2"><div id="p2-progress" class="progress-bar-fill" style="background:#1e88e5"></div></div>
        </div>
        
        <div style="background:#e0f7fa; border:1px solid #4dd0e1; border-radius:8px; padding:8px; text-align:center; font-size:12px; color:#006064; flex-shrink:0;"><b>ğŸ’° å‡¯åˆ©å…¬å¼</b><br>èƒœç‡é«˜å°±æŠ•ï¼Œèƒœç‡ä½å°±æ’¤</div>
        
        <div id="p1-card" class="player-card active">
            <div style="display:flex; justify-content:space-between; align-items:center"><span>ğŸ¦Š å°¼å…‹</span><span id="p1-money" class="money-display">100</span></div>
            <div style="font-size:10px; color:#aaa; margin-top:2px;">(è‡ªåŠ¨ç»“ç®—)</div>
        </div>
        
        <div id="p2-card" class="player-card">
            <div style="display:flex; justify-content:space-between; align-items:center"><span>ğŸ° æœ±è¿ª</span><span id="p2-money" class="money-display">100</span></div>
            <div class="math-toggle-row">
                <span>å£ç®—ç»ƒä¹ </span>
                <label class="switch"><input type="checkbox" id="math-toggle" checked onchange="game.toggleP2Math()"><span class="slider"></span></label>
            </div>
        </div>

        <div id="log-box"></div>
        <div id="action-area">
            <div class="cube-wrapper"><div class="cube" id="dice-cube"><div class="cube-face face-1"></div><div class="cube-face face-2"></div><div class="cube-face face-3"></div><div class="cube-face face-4"></div><div class="cube-face face-5"></div><div class="cube-face face-6"></div></div></div>
            <button class="roll-btn" id="roll-btn" onclick="game.rollDice()">ğŸ² æ·éª°å­</button>
        </div>
    </div>

    <div id="board"></div>
</div>

<!-- å¼¹çª—ï¼šå¼€å§‹ -->
<div id="modal-start" class="modal-overlay" style="display:flex;">
    <div class="modal-box" style="background:#e3f2fd;">
        <h2 style="color:#0277bd; margin-top:0;">ğŸ™ï¸ ç–¯ç‹‚åŠ¨ç‰©åŸä¹‹æ—…</h2>
        <div class="start-option selected" id="opt-1" onclick="game.selectMode(1)">
            <div><b style="color:#e65100">ğŸ† ç«é€Ÿ</b><br><span style="font-size:11px;color:#666">ç›®æ ‡é‡‘å¸</span></div>
            <input type="number" id="input-target" class="custom-input" value="1000" step="100" onclick="event.stopPropagation()">
        </div>
        <div class="start-option" id="opt-2" onclick="game.selectMode(2)">
            <div><b style="color:#0d47a1">â±ï¸ é™æ—¶</b><br><span style="font-size:11px;color:#666">é™å®šå›åˆ</span></div>
            <input type="number" id="input-rounds" class="custom-input" value="20" step="5" onclick="event.stopPropagation()">
        </div>
        <div class="start-option" id="opt-3" onclick="game.selectMode(3)">
            <div><b style="color:#1b5e20">ğŸ¢ ç”Ÿå­˜</b><br><span style="font-size:11px;color:#666">ç›´åˆ°ç ´äº§</span></div>
        </div>
        <button class="btn-main" onclick="game.start()">ğŸš“ å‡ºå‘ï¼</button>
    </div>
</div>

<!-- å¼¹çª—ï¼šæ•°å­¦ -->
<div id="modal-math" class="modal-overlay">
    <div class="modal-box" style="background:#e1f5fe; border:4px solid #4fc3f7;">
        <div style="font-size:40px;">ğŸ§®</div>
        <h3 style="color:#01579b; margin:5px 0;">ç®—æœ¯æŒ‘æˆ˜</h3>
        <p style="color:#555; margin-bottom:15px;">ç®—å‡ºç»“æœï¼Œè·å¾—æ”¶ç›Šï¼</p>
        <div class="math-eq" id="math-display">100 + 20 = ?</div>
        <input type="number" id="math-input" class="math-input" placeholder="?" onkeydown="if(event.key==='Enter') game.checkMath()">
        <div id="math-msg" style="height:20px; color:#c62828; font-weight:bold; margin-top:10px;"></div>
        <button class="btn-main" onclick="game.checkMath()">æäº¤ç­”æ¡ˆ</button>
    </div>
</div>

<!-- å¼¹çª—ï¼šäº¤æ˜“ -->
<div id="modal-trade" class="modal-overlay">
    <div class="modal-box">
        <h3 id="trade-title" style="margin:0;color:#006064;">åœ°ç‚¹</h3>
        <div class="trade-info">
            <div style="display:flex; justify-content:space-between;"><span>ğŸ“ˆ èƒœç‡: <b id="trade-prob" style="color:#e65100">0%</b></span><span style="font-size:11px; color:#555">ç›ˆäº Â±100%</span></div>
            <div style="width:100%; height:6px; background:#fff; margin-top:5px; border-radius:3px;"><div id="prob-bar" style="width:0%; height:100%; background:#ffd700; transition:width 0.5s;"></div></div>
        </div>
        <div id="trade-input-ui">
            <p style="margin:5px 0;font-size:14px;color:#455a64">æŠ•å…¥: <b id="invest-val" style="color:#e65100;font-size:18px;">0 (0%)</b></p>
            <input type="range" id="invest-range" value="0" min="0" oninput="game.updateInvestUI()">
            <div class="btn-grid">
                <button class="btn-opt" onclick="game.setInvest(0.1)">10%</button><button class="btn-opt" onclick="game.setInvest(0.2)">20%</button>
                <button class="btn-opt" onclick="game.setInvest(0.5)">50%</button><button class="btn-opt" style="background:#ff7043;color:white" onclick="game.setInvest(1.0)">All</button>
            </div>
            <button class="btn-main" onclick="game.confirmTrade()">ğŸ’° ç¡®è®¤æŠ•èµ„</button>
        </div>
        <div id="trade-result"></div>
    </div>
</div>

<!-- å¼¹çª—ï¼šçŒ«å·´å£« -->
<div id="modal-catbus" class="modal-overlay">
    <div class="modal-box" style="background:#fff3e0; border:4px solid #ffb74d;">
        <div style="font-size:50px;">ğŸš…</div>
        <h3 style="color:#e65100; margin:5px 0;">åŠ¨ç‰©åŸå¿«çº¿</h3>
        <p style="color:#555; font-size:13px;">è¯·é€‰æ‹©ä¸‹ä¸€ç«™ï¼š</p>
        <div id="catbus-options"></div>
    </div>
</div>

<!-- å¼¹çª—ï¼šé—®ç­” -->
<div id="modal-quiz" class="modal-overlay">
    <div class="modal-box">
        <div style="font-size:40px; margin-bottom:10px;">ğŸ©</div>
        <h3 style="margin:0 0 10px 0; color:#1565c0;">è±¹è­¦å®˜çš„æé—®</h3>
        <div class="quiz-question" id="quiz-q">é¢˜ç›®...</div>
        <div id="quiz-options"></div>
        <div id="quiz-feedback"></div>
        <button class="btn-main" id="quiz-close-btn" style="display:none; background:#90a4ae;" onclick="game.closeQuiz()">ç»§ç»­</button>
    </div>
</div>

<!-- å¼¹çª—ï¼šä¿¡æ¯ -->
<div id="modal-info" class="modal-overlay">
    <div class="modal-box">
        <div id="info-icon" style="font-size:40px; margin-bottom:10px;">ğŸ</div>
        <h3 id="info-title" style="color:#00695c">æ ‡é¢˜</h3>
        <p id="info-desc" style="font-size:14px; color:#555; margin:15px 0;">å†…å®¹</p>
        <button class="btn-main" onclick="game.closeInfo()">ç¡®å®š</button>
    </div>
</div>

<!-- å¼¹çª—ï¼šç»“æŸ -->
<div id="modal-end" class="modal-overlay">
    <div class="modal-box" style="border-top:5px solid #ffd700;">
        <div style="font-size:60px;">ğŸ†</div>
        <h2 id="end-title" style="margin:10px 0; color:#e65100;">æ¸¸æˆç»“æŸ!</h2>
        <p id="end-reason" style="color:#555;">åŸå› </p>
        <div style="margin-top:15px; display:flex; justify-content:space-between; background:#f1f8e9; padding:10px; border-radius:10px; font-weight:bold; color:#33691e;">
            <span>ğŸ¦Š <span id="end-p1-money">0</span></span><span>ğŸ° <span id="end-p2-money">0</span></span>
        </div>
        <h3 id="winner-name" style="color:#2e7d32; margin-top:15px;"></h3>
        <button class="btn-main" onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<script>
/** 
 * SoundFX - éŸ³æ•ˆæ§åˆ¶
 */
const SoundFX = {
    ctx: null,
    init: function() {
        if (!this.ctx) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            } catch(e) { console.warn("Web Audio API not supported"); }
        }
        if (this.ctx && this.ctx.state === 'suspended') {
            this.ctx.resume();
        }
        // æ’­æ”¾æ— å£°çŸ­éŸ³ä»¥æ¿€æ´» iOS éŸ³é¢‘
        this.playTone(440, 'sine', 0.01, 0.001);
    },
    playTone: function(freq, type, duration, vol=0.1) {
        if (!this.ctx) return;
        try {
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            gain.gain.setValueAtTime(vol, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.start();
            osc.stop(this.ctx.currentTime + duration);
        } catch(e) {}
    },
    playRoll: function() { 
        for(let i=0; i<6; i++) {
            setTimeout(() => this.playTone(600 + Math.random()*200, 'square', 0.05, 0.05), i*60);
        }
    },
    playStep: function() { this.playTone(300, 'sine', 0.1, 0.1); },
    playWin: function() { 
        this.playTone(500, 'triangle', 0.2, 0.1); 
        setTimeout(() => this.playTone(800, 'triangle', 0.4, 0.1), 200); 
    },
    playWarp: function() { 
        this.playTone(200, 'sine', 0.1, 0.1);
        setTimeout(() => this.playTone(400, 'sine', 0.2, 0.1), 100);
        setTimeout(() => this.playTone(600, 'sine', 0.3, 0.1), 200);
    }
};

/** 
 * Game Logic
 */
const game = {
    turn: 0,
    round: 1,
    isAnimating: false,
    mode: 1, // 1:Target, 2:Rounds, 3:Survival
    target: 1000,
    maxRounds: 20,
    diceRot: {x:0, y:0},
    currentTrade: null,
    pendingMath: null,
    p2MathMode: true,

    players: [
        { id:0, name:"å°¼å…‹", money:100, pos:0, color:"#e65100", icon:"ğŸ¦Š" },
        { id:1, name:"æœ±è¿ª", money:100, pos:0, color:"#1e88e5", icon:"ğŸ°" }
    ],

    // 32æ ¼è·¯å¾„æ˜ å°„ (6x6 - 4)
    pathMap: [
        {r:1,c:1,d:'â†’'},{r:1,c:2,d:'â†’'},{r:1,c:3,d:'â†’'},{r:1,c:4,d:'â†’'},{r:1,c:5,d:'â†’'},{r:1,c:6,d:'â†“'},
        {r:2,c:6,d:'â†“'},{r:3,c:6,d:'â†“'},{r:4,c:6,d:'â†“'},{r:5,c:6,d:'â†“'},{r:6,c:6,d:'â†'},
        {r:6,c:5,d:'â†'},{r:6,c:4,d:'â†'},{r:6,c:3,d:'â†'},{r:6,c:2,d:'â†'},{r:6,c:1,d:'â†‘'},
        {r:5,c:1,d:'â†‘'},{r:4,c:1,d:'â†‘'},{r:3,c:1,d:'â†‘'},{r:2,c:1,d:'â†’'},
        {r:2,c:2,d:'â†’'},{r:2,c:3,d:'â†’'},{r:2,c:4,d:'â†’'},{r:2,c:5,d:'â†“'},
        {r:3,c:5,d:'â†“'},{r:4,c:5,d:'â†“'},{r:5,c:5,d:'â†'},{r:5,c:4,d:'â†'},{r:5,c:3,d:'â†'},{r:5,c:2,d:'â†‘'},{r:4,c:2,d:'â†‘'},{r:3,c:2,d:'â†‘'}
    ],

    mapData: [
        { name: "è­¦å±€", type: "t-start", icon: "ğŸ‘®", info: "å·¥èµ„+20" },
        { name: "çˆªçˆªå†°æ£", type: "t-city", icon: "ğŸ¾", industry: "é›¶å”®", minP:0.65, maxP:0.80 },
        { name: "åŠ¨ç‰©åŸå¿«çº¿", type: "t-fun", icon: "ğŸš…", info: "éšæœºç©¿æ¢­" },
        { name: "å¤§ç”œç”œåœˆ", type: "t-city", icon: "ğŸ©", industry: "é¤é¥®", minP:0.60, maxP:0.75 },
        { name: "å¤å¥‡ç¾Š", type: "t-luck", icon: "ğŸ¤", info: "æ¼”å”±ä¼š" },
        { name: "åˆå¤œåšå«", type: "t-trap", icon: "ğŸŒº", industry: "æœ‰æ¯’", minP:0.10, maxP:0.35 }, 
        
        { name: "èŠ¬å°¼å…‹", type: "t-fun", icon: "ğŸš™", info: "éšæœº" },
        { name: "å†°å·é•‡", type: "t-city", icon: "ğŸ§Š", industry: "å†°å—", minP:0.65, maxP:0.85 },
        { name: "èƒ¡èåœåœº", type: "t-city", icon: "ğŸ¥•", industry: "å†œåœº", minP:0.60, maxP:0.85 },
        { name: "å¤§å…ˆç”Ÿ", type: "t-city", icon: "ğŸ­", industry: "é£æŠ•", minP:0.65, maxP:0.90 },
        { name: "æ˜æ—¥ä¸–ç•Œ", type: "t-city", icon: "ğŸš€", industry: "ç§‘æŠ€", minP:0.55, maxP:0.90 },
        
        { name: "é›¨æ—åŒº", type: "t-city", icon: "ğŸƒ", industry: "æ—…æ¸¸", minP:0.60, maxP:0.80 },
        { name: "ç‹®å¸‚é•¿", type: "t-luck", icon: "ğŸ¦", info: "æ‹¨æ¬¾" },
        { name: "å¤§è±¡åº—", type: "t-city", icon: "ğŸ˜", industry: "å†·é¥®", minP:0.60, maxP:0.85 },
        { name: "è­¦æ ¡ç‰¹è®­", type: "t-school", icon: "ğŸ«", info: "èƒœç‡UP" },
        { name: "è±¹è­¦å®˜", type: "t-quiz", icon: "ğŸ©", info: "ç­”é¢˜" },
        
        { name: "æ’’å“ˆæ‹‰", type: "t-city", icon: "ğŸœï¸", industry: "é…’åº—", minP:0.55, maxP:0.75 },
        { name: "éœ²éœ²å°å§", type: "t-city", icon: "ğŸ‘—", industry: "æ—¶å°š", minP:0.55, maxP:0.75 },
        { name: "è½¦ç®¡æ‰€", type: "t-bad", icon: "ğŸ¦¥", info: "äº¤ç¨10%" }, 
        { name: "ç›—ç‰ˆç¢Ÿ", type: "t-city", icon: "ğŸ’¿", industry: "åª’ä½“", minP:0.65, maxP:0.80 },
        
        { name: "ç‘œä¼½ä¿±ä¹éƒ¨", type: "t-city", icon: "ğŸ§˜", industry: "å¥åº·", minP:0.60, maxP:0.75 },
        { name: "ç¾Šå‰¯å¸‚é•¿", type: "t-fun", icon: "ğŸ‘", info: "ç¤¼ç‰©" },
        { name: "å°å•®é½¿é•‡", type: "t-city", icon: "ğŸ ", industry: "åœ°äº§", minP:0.60, maxP:0.80 },
        { name: "ç¼†è½¦", type: "t-city", icon: "ğŸš ", industry: "äº¤é€š", minP:0.60, maxP:0.75 },
        
        { name: "åšç‰©é¦†", type: "t-city", icon: "ğŸ›ï¸", industry: "æ–‡åŒ–", minP:0.60, maxP:0.80 },
        { name: "çƒ­æ°”çƒ", type: "t-city", icon: "ğŸˆ", industry: "è§‚å…‰", minP:0.55, maxP:0.90 },
        { name: "åŸå¸‚å‹‹ç« ", type: "t-super", icon: "ğŸ…", info: "èµ„äº§ç¿»å€" }, 
        { name: "æœ±è¿ªçˆ¸å¦ˆ", type: "t-luck", icon: "ğŸ‘ª", info: "è·å¾—+15" },
        { name: "è“è“", type: "t-city", icon: "ğŸ«", industry: "å†œä¸š", minP:0.55, maxP:0.75 },
        { name: "ç‰›å±€é•¿", type: "t-luck", icon: "ğŸƒ", info: "æŒ‡å¼•+10" },
        { name: "å½•éŸ³ç¬”", type: "t-city", icon: "ğŸ–Šï¸", industry: "æ•°ç ", minP:0.60, maxP:0.80 },
        { name: "äº¤é€šç½šå•", type: "t-city", icon: "ğŸ“", industry: "å¸‚æ”¿", minP:0.60, maxP:0.80 }
    ],

    quizBank: [
        { q: "å°¼å…‹é å€’å–å†°æ£èµšé’±ï¼Œè¿™å«ä»€ä¹ˆï¼Ÿ", opts: ["èµšå·®ä»·(åˆ©æ¶¦)", "åšæ…ˆå–„", "æµªè´¹æ—¶é—´"], ans: 0 },
        { q: "æœ±è¿ªæƒ³å½“è­¦å¯Ÿä½†å¤§å®¶è®©å¥¹ç§èƒ¡èåœï¼Œè¿™è¯´æ˜ï¼Ÿ", opts: ["åˆ«äººæ€»æ˜¯å¯¹çš„", "è¦åšæŒæ¢¦æƒ³", "èƒ¡èåœå¥½åƒ"], ans: 1 },
        { q: "å¦‚æœé—ªç”µ(æ ‘æ‡’)å¸®ä½ ç†è´¢ï¼Œç¼ºç‚¹æ˜¯ï¼Ÿ", opts: ["å¤ªå¿«äº†", "æ•ˆç‡å¤ªä½(æµåŠ¨æ€§å·®)", "å¾ˆå¯çˆ±"], ans: 1 },
        { q: "åˆå¤œåšå«èŠ±æœµçœ‹èµ·æ¥æ¼‚äº®ä½†æœ‰æ¯’ï¼Œè¿™åƒï¼Ÿ", opts: ["é«˜é£é™©è¯ˆéª—", "å®‰å…¨å­˜æ¬¾", "ä¹°ç³–æœ"], ans: 0 },
        { q: "æƒ³åœ¨åŠ¨ç‰©åŸä¹°å¤§æˆ¿å­ï¼Œå°¼å…‹åº”è¯¥ï¼Ÿ", opts: ["å»å·", "å­˜é’±æŠ•èµ„", "ç­‰å¤©ä¸Šæ‰é¦…é¥¼"], ans: 1 },
        { q: "æŠŠé’±åˆ†ç»™ä¸åŒçš„åŠ¨ç‰©åšç”Ÿæ„ï¼Œè¿™å«ï¼Ÿ", opts: ["åˆ†æ•£é£é™©", "ä¹±èŠ±é’±", "é€ç¤¼ç‰©"], ans: 0 },
        { q: "å¤§å…ˆç”Ÿè™½ç„¶å°ä½†æœ‰é’±ï¼Œå› ä¸ºä»–æ‡‚å¾—ï¼Ÿ", opts: ["ç§¯ç´¯èµ„æºäººè„‰", "åƒç”œç”œåœˆ", "ç¡è§‰"], ans: 0 }
    ],

    // --- æ–¹æ³• ---
    toggleP2Math: function() {
        this.p2MathMode = document.getElementById('math-toggle').checked;
    },

    selectMode: function(m) {
        this.mode = m;
        document.querySelectorAll('.start-option').forEach(el => el.classList.remove('selected'));
        document.getElementById('opt-'+m).classList.add('selected');
    },

    start: function() {
        SoundFX.init(); // å°è¯•åˆå§‹åŒ–éŸ³æ•ˆ
        document.getElementById('modal-start').style.display = 'none';
        
        // è¯»å–é…ç½®
        if(this.mode===1) this.target = parseInt(document.getElementById('input-target').value) || 1000;
        if(this.mode===2) this.maxRounds = parseInt(document.getElementById('input-rounds').value) || 20;

        let goalStr = this.mode===1 ? `ğŸ† ${this.target}` : (this.mode===2 ? `â±ï¸ ${this.maxRounds}R` : "ğŸ’€ ç”Ÿå­˜");
        document.getElementById('goal-text').innerText = goalStr;

        this.initBoard();
        this.updateUI();
        this.log("æ¬¢è¿æ¥åˆ°ç–¯ç‹‚åŠ¨ç‰©åŸï¼", "#00838f");
    },

    initBoard: function() {
        const board = document.getElementById('board');
        board.innerHTML = '';
        
        // ä¸­é—´ä»ªè¡¨ç›˜
        const center = document.createElement('div');
        center.className = 'center-area';
        center.innerHTML = `<div id="center-icon" class="center-icon">ğŸ™ï¸</div><div id="center-title" style="font-weight:bold;color:#006064;font-size:16px;">åŠ¨ç‰©åŸå¿«è®¯</div><div id="center-desc" style="font-size:12px;color:#00838f;">å°è¯•ä¸€åˆ‡ï¼</div>`;
        board.appendChild(center);

        // æ ¼å­
        this.mapData.forEach((d, i) => {
            let div = document.createElement('div');
            div.className = `cell ${d.type}`;
            div.style.gridRow = this.pathMap[i].r;
            div.style.gridColumn = this.pathMap[i].c;
            div.setAttribute('data-arrow', this.pathMap[i].d);
            div.innerHTML = `<div class="cell-icon">${d.icon}</div><div class="cell-name">${d.name}</div><div class="cell-info">${d.industry || d.info}</div>`;
            board.appendChild(div);
        });

        // æ£‹å­
        this.players.forEach(p => {
            let el = document.createElement('div');
            el.className = 'token-container';
            el.innerHTML = `<div class="character-sprite">${p.icon}</div>`;
            board.appendChild(el);
            p.el = el;
        });

        // åˆå§‹ä½ç½®
        setTimeout(() => {
            this.placePlayer(this.players[0], 0);
            this.placePlayer(this.players[1], 0);
        }, 100);
    },

    placePlayer: function(p, idx, anim=false) {
        if(idx >= this.mapData.length) idx = 0;
        p.pos = idx;
        const cell = document.querySelectorAll('.cell')[idx];
        if(!cell) return;
        const cRect = cell.getBoundingClientRect();
        const bRect = document.getElementById('board').getBoundingClientRect();
        
        let cx = cRect.left - bRect.left + cRect.width/2;
        let cy = cRect.top - bRect.top + cRect.height/2;
        let ox = p.id===0 ? -12 : 12;

        if(anim) {
            let currC = this.pathMap[idx].c;
            let nextIdx = (idx+1) % this.mapData.length;
            if(this.pathMap[nextIdx].c > currC) p.el.style.setProperty('--face-dir', 1);
            else if(this.pathMap[nextIdx].c < currC) p.el.style.setProperty('--face-dir', -1);
        }

        p.el.style.left = (cx + ox - 20) + 'px';
        p.el.style.top = (cy - 40) + 'px';
    },

    // --- æ¸¸æˆæµç¨‹ ---
    rollDice: function() {
        if(this.isAnimating) return;
        this.isAnimating = true;
        document.getElementById('roll-btn').disabled = true;
        
        // éª°å­åŠ¨ç”»
        const val = Math.floor(Math.random()*6)+1;
        const faces = [{x:0,y:0}, {x:0,y:-90}, {x:-90,y:0}, {x:90,y:0}, {x:0,y:90}, {x:0,y:180}];
        
        // æ—‹è½¬
        let nextX = this.diceRot.x + 360*2 + faces[val-1].x - (this.diceRot.x%360);
        let nextY = this.diceRot.y + 360*2 + faces[val-1].y - (this.diceRot.y%360);
        this.diceRot = {x:nextX, y:nextY};
        
        document.getElementById('dice-cube').style.transform = `rotateX(${nextX}deg) rotateY(${nextY}deg)`;
        SoundFX.playRoll();

        setTimeout(() => {
            this.log(`ğŸ² ç‚¹æ•°: <b>${val}</b>`);
            this.moveStep(this.players[this.turn], val);
        }, 1200);
    },

    moveStep: function(p, steps) {
        let left = steps;
        p.el.classList.add('walking');
        
        let timer = setInterval(() => {
            let next = (p.pos + 1) % this.mapData.length;
            SoundFX.playStep();
            
            // ç»è¿‡èµ·ç‚¹
            if(next === 0 && p.pos === this.mapData.length - 1) {
                p.money += 20;
                this.log(`ğŸ‘® ç»è¿‡è­¦å±€ï¼Œè·å¾—å·¥èµ„+20`, '#009688');
                this.updateUI();
            }

            this.placePlayer(p, next, true);
            left--;
            
            if(left <= 0) {
                clearInterval(timer);
                p.el.classList.remove('walking');
                setTimeout(() => this.handleEvent(p), 300);
            }
        }, 250);
    },

    handleEvent: function(p) {
        const d = this.mapData[p.pos];
        this.log(`${p.name} æ¥åˆ°äº† ${d.name}`);
        this.updateCenter(d.icon, d.name, d.industry || d.info);

        if(d.type === 't-city' || d.type === 't-trap') {
            this.openTradeModal(d, p);
        } else if(d.name === "è±¹è­¦å®˜") {
            this.openQuiz(p);
        } else if(d.name === "åŠ¨ç‰©åŸå¿«çº¿") {
            this.showCatbusChoice(p);
        } else if(d.name === "å¤å¥‡ç¾Š" || d.name === "ç‹®å¸‚é•¿" || d.name === "æœ±è¿ªçˆ¸å¦ˆ" || d.name === "ç‰›å±€é•¿") {
            SoundFX.playWin();
            this.triggerMath(p, 10, ()=> { this.log("âœ¨ å¥½è¿é™ä¸´ +10", "#e65100"); this.updateUI(); this.nextTurn(); });
        } else if(d.type === 't-fun') {
            let amt = Math.random()>0.5 ? 15 : -10;
            this.triggerMath(p, amt, ()=> { this.log(amt>0?"ğŸ æ„å¤–æƒŠå–œ":"ğŸ’¨ å¤±å»ä¸€ç‚¹é‡‘å¸", "#555"); this.updateUI(); this.nextTurn(); });
        } else if(d.name === "è½¦ç®¡æ‰€") { 
            let loss = -Math.round(p.money * 0.1);
            this.triggerMath(p, loss, ()=> { this.log("ğŸ¦¥ ç¼´çº³ç½šæ¬¾", "red"); this.updateUI(); this.nextTurn(); });
        } else if(d.type === 't-school') {
            this.triggerMath(p, -5, ()=> { p.buff = 0.15; this.log("ğŸ« è­¦æ ¡å­¦ä¹ ï¼Œèƒœç‡æå‡", "blue"); this.updateUI(); this.nextTurn(); });
        } else if(d.type === 't-super') {
            let bonus = p.money; // Double
            SoundFX.playWin();
            this.triggerMath(p, bonus, ()=> { this.log("ğŸ’ è·å¾—åŸå¸‚å‹‹ç« ï¼Œèµ„äº§ç¿»å€ï¼", "#8e24aa"); this.updateUI(); this.nextTurn(); });
        } else {
            this.nextTurn();
        }
    },

    // --- çŒ«å·´å£«é€»è¾‘ ---
    showCatbusChoice: function(p) {
        let choices = [];
        while(choices.length < 3) {
            let r = Math.floor(Math.random() * this.mapData.length);
            if(r !== p.pos && !choices.includes(r)) choices.push(r);
        }
        
        const container = document.getElementById('catbus-options');
        container.innerHTML = '';
        choices.forEach(idx => {
            let d = this.mapData[idx];
            let btn = document.createElement('div');
            btn.className = 'catbus-btn';
            btn.innerHTML = `<div class="catbus-icon">${d.icon}</div><div><b>${d.name}</b><br><span style="font-size:10px;color:#666">${d.info||d.industry}</span></div>`;
            btn.onclick = () => {
                SoundFX.playWarp();
                document.getElementById('modal-catbus').style.display = 'none';
                this.placePlayer(p, idx);
                setTimeout(() => this.handleEvent(p), 500);
            };
            container.appendChild(btn);
        });
        document.getElementById('modal-catbus').style.display = 'flex';
    },

    // --- æ™ºèƒ½ç®—æœ¯é€»è¾‘ ---
    triggerMath: function(player, amount, callback) {
        if(amount === 0) { callback(); return; } 
        let changeVal = Math.round(amount);

        let autoCalc = false;
        if(player.id === 0) autoCalc = true;
        else if(player.id === 1 && !this.p2MathMode) autoCalc = true;

        if(autoCalc) {
            player.money += changeVal;
            this.updateUI();
            let sign = changeVal > 0 ? "+" : "";
            this.log(`(è‡ªåŠ¨) ${player.name} èµ„é‡‘ ${sign}${changeVal}`, player.id===0?"#e65100":"#1e88e5");
            setTimeout(callback, 800);
            return;
        }

        this.pendingMath = { player: player, change: changeVal, callback: callback };
        let current = Math.floor(player.money);
        let sign = changeVal >= 0 ? "+" : "-";
        document.getElementById('math-display').innerText = `${current} ${sign} ${Math.abs(changeVal)} = ?`;
        document.getElementById('math-input').value = ""; document.getElementById('math-msg').innerText = "";
        document.getElementById('modal-math').style.display = 'flex'; document.getElementById('math-input').focus();
    },

    checkMath: function() {
        let val = parseInt(document.getElementById('math-input').value);
        if(val === this.pendingMath.player.money + this.pendingMath.change) {
            document.getElementById('modal-math').style.display = 'none';
            this.pendingMath.player.money = val;
            if(this.pendingMath.callback) this.pendingMath.callback();
        } else {
            document.getElementById('math-msg').innerText = "ä¸å¯¹å“¦ï¼Œå†ç®—ç®—ï¼";
            document.querySelector('#modal-math .modal-box').classList.add('shake');
            setTimeout(()=>document.querySelector('#modal-math .modal-box').classList.remove('shake'), 500);
        }
    },

    // --- äº¤æ˜“ ---
    openTradeModal: function(data, p) {
        this.currentTrade = { p: p, baseP: (Math.random()*(data.maxP-data.minP)+data.minP) };
        let finalP = this.currentTrade.baseP + (p.buff||0); if(finalP>0.95) finalP=0.95;
        this.currentTrade.finalP = finalP;
        
        document.getElementById('modal-trade').style.display = 'flex';
        document.getElementById('trade-title').innerText = `${data.icon} ${data.name}`;
        document.getElementById('trade-prob').innerText = `${Math.round(finalP*100)}%`;
        document.getElementById('prob-bar').style.width = `${finalP*100}%`;
        document.getElementById('trade-prob').style.color = finalP < 0.5 ? '#e74c3c' : '#e65100';
        document.getElementById('invest-range').max = Math.floor(p.money); 
        document.getElementById('invest-range').value = 0; 
        this.updateInvestUI();
        document.getElementById('trade-input-ui').style.display='block'; 
        document.getElementById('trade-result').innerHTML='';
    },
    
    updateInvestUI: function() {
        let v = document.getElementById('invest-range').value;
        let m = document.getElementById('invest-range').max;
        document.getElementById('invest-val').innerText = `${v} (${m>0?Math.round(v/m*100):0}%)`;
    },
    
    setInvest: function(r) { 
        document.getElementById('invest-range').value = Math.round(this.currentTrade.p.money*r); 
        this.updateInvestUI(); 
    },
    
    confirmTrade: function() {
        let bet = parseInt(document.getElementById('invest-range').value);
        if(bet === 0) { document.getElementById('modal-trade').style.display='none'; this.nextTurn(); return; }
        
        document.getElementById('trade-input-ui').style.display='none';
        let win = Math.random() <= this.currentTrade.finalP;
        let html = win ? `<div class="trade-info" style="border:1px solid #66bb6a;background:#e8f5e9"><b>âœ¨ æˆåŠŸ</b></div>` : `<div class="trade-info" style="border:1px solid #ef5350;background:#ffebee"><b>ğŸ¥€ å¤±è´¥</b></div>`;
        document.getElementById('trade-result').innerHTML = html;
        if(win) SoundFX.playWin();
        
        setTimeout(() => { 
            document.getElementById('modal-trade').style.display='none'; 
            this.triggerMath(this.currentTrade.p, win?bet:-bet, ()=>{ 
                if(win) this.log(`ç›ˆåˆ© ${bet}`,'green'); else this.log(`äºæŸ ${bet}`,'red'); 
                this.updateUI(); this.nextTurn(); 
            }); 
        }, 1000);
    },

    openQuiz: function(p) {
        let q = this.quizBank[Math.floor(Math.random()*this.quizBank.length)];
        document.getElementById('quiz-q').innerText = q.q;
        const div = document.getElementById('quiz-options'); div.innerHTML='';
        q.opts.forEach((o,i)=> {
            let b=document.createElement('button'); b.className='quiz-btn'; b.innerText=["A. ","B. "][i]+o;
            b.onclick=()=>{
                div.innerHTML = i===q.ans ? `<div style="color:green;font-weight:bold;margin-top:10px">âœ… æ­£ç¡®ï¼</div>` : `<div style="color:red;font-weight:bold;margin-top:10px">âŒ é”™è¯¯</div>`;
                document.getElementById('quiz-close-btn').style.display='block';
                if(i===q.ans) SoundFX.playWin();
                document.getElementById('quiz-close-btn').onclick=()=>{
                    document.getElementById('modal-quiz').style.display='none';
                    this.triggerMath(p, i===q.ans?10:-5, ()=>{this.updateUI(); this.nextTurn();});
                }
            }; div.appendChild(b);
        });
        document.getElementById('quiz-close-btn').style.display='none'; document.getElementById('modal-quiz').style.display='flex';
    },

    closeQuiz: function() { document.getElementById('modal-quiz').style.display='none'; this.nextTurn(); },
    
    updateUI: function() {
        document.getElementById('p1-money').innerText = Math.floor(this.players[0].money);
        document.getElementById('p2-money').innerText = Math.floor(this.players[1].money);
        
        let p1p = this.mode===1 ? Math.min(100, this.players[0].money/this.target*100) : 0;
        document.getElementById('p1-progress').style.width = p1p+"%";
        document.getElementById('p2-progress').style.width = (this.mode===1?Math.min(100, this.players[1].money/this.target*100):0)+"%";
        
        document.getElementById('turn-text').innerText = "R: "+this.round;
        document.getElementById('p1-card').classList.toggle('active', this.turn===0);
        document.getElementById('p2-card').classList.toggle('active', this.turn===1);
    },

    nextTurn: function() {
        if(this.players[this.turn].money <= 0) { this.endGame("é‡‘å¸è€—å°½"); return; }
        if(this.mode===1 && this.players[this.turn].money >= this.target) { this.endGame("è¾¾æˆç›®æ ‡"); return; }

        this.turn = (this.turn + 1) % 2;
        if(this.turn === 0) {
            this.round++;
            if(this.mode===2 && this.round > this.maxRounds) { this.endGame("å›åˆç»“æŸ"); return; }
        }

        this.isAnimating = false;
        document.getElementById('roll-btn').disabled = false;
        this.updateUI();
        this.log(`ğŸ‘‰ è½®åˆ° ${this.players[this.turn].name}`, this.turn===0?"#e65100":"#1e88e5");
    },

    endGame: function(reason) {
        document.getElementById('modal-end').style.display='flex';
        document.getElementById('end-reason').innerText = reason;
        document.getElementById('end-p1-money').innerText=this.players[0].money;
        document.getElementById('end-p2-money').innerText=this.players[1].money;
        let win = this.players[0].money > this.players[1].money ? "ğŸ¦Š å°¼å…‹" : "ğŸ° æœ±è¿ª";
        document.getElementById('winner-name').innerText = "ğŸ‰ " + win + " è·èƒœ!";
    },

    log: function(msg, color='#333') {
        let d = document.createElement('div');
        d.innerHTML = msg; d.style.color = color;
        document.getElementById('log-box').prepend(d);
    },
    
    updateCenter: function(i,t,d) {
        document.getElementById('center-icon').innerText=i;
        document.getElementById('center-title').innerText=t;
        document.getElementById('center-desc').innerText=d;
    },
    
    closeInfo: function() { document.getElementById('modal-info').style.display='none'; this.nextTurn(); }
};

window.onload = function() {
    game.log("å‡†å¤‡å°±ç»ª...", "#999");
};
</script>
</body>
</html>