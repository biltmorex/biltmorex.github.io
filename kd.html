<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒéª°å­å‡¯åˆ©æŠ•èµ„æˆ˜ v2.1</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --panel-bg: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-blue: #3b82f6;
            --accent-pink: #ec4899;
            --accent-green: #10b981;
            --accent-gold: #f59e0b;
            --dice-size: 80px;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* é¡¶éƒ¨æ å¸ƒå±€ */
        .header-bar {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #334155;
            padding-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .title-group h1 { margin: 0; font-size: 1.5rem; background: linear-gradient(90deg, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .title-group .subtitle { color: var(--text-secondary); font-size: 0.85rem; margin: 5px 0 0 0; }

        .status-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* è½®æ•°è®¡æ•°å™¨ */
        .round-badge {
            background: #334155;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1rem;
            color: var(--accent-gold);
            border: 1px solid #475569;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .reset-btn {
            background: transparent;
            border: 1px solid #475569;
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex; align-items: center; gap: 6px;
        }
        .reset-btn:hover { background: rgba(255, 255, 255, 0.05); color: #fff; border-color: #64748b; }
        .reset-btn:active { transform: scale(0.95); }

        /* --- é¡¶éƒ¨è®¾ç½®åŒº (æ¦‚ç‡é€‰æ‹©) --- */
        .settings-card {
            background: var(--panel-bg);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 900px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid #334155;
            margin-bottom: 25px;
        }

        .prob-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .win-rate-badge {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent-green);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-family: monospace;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .win-rate-badge.bad { color: var(--accent-pink); background: rgba(236, 72, 153, 0.1); border-color: rgba(236, 72, 153, 0.3); }

        .number-selector { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }

        .num-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 50px; height: 65px;
            background: #334155;
            border: 2px solid transparent; border-radius: 10px;
            cursor: pointer; transition: all 0.2s;
        }
        .num-btn span { font-size: 1.2rem; font-weight: bold; color: #cbd5e1; }
        .num-btn .dots { font-size: 8px; letter-spacing: 1px; color: #64748b; margin-top: 4px; }
        .num-btn.active { background: var(--accent-gold); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3); }
        .num-btn.active span { color: #000; }
        .num-btn.active .dots { color: #78350f; }

        /* --- ç©å®¶å¡ç‰‡åŒº --- */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
            margin-bottom: 30px;
        }

        .player-card {
            background: var(--panel-bg);
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid #334155;
            transition: transform 0.2s;
        }
        .player-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; }
        
        .card-kelly::before { background: var(--accent-blue); }
        .card-daughter::before { background: var(--accent-pink); }
        .card-father::before { background: var(--accent-green); }

        .p-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .p-name { font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
        .p-balance { font-size: 1.8rem; font-weight: 800; font-family: 'Courier New', monospace; letter-spacing: -1px; }

        .bet-container { margin-top: 15px; position: relative; }
        .bet-label { font-size: 0.8rem; color: var(--text-secondary); display: block; margin-bottom: 5px; }
        
        .input-wrapper { position: relative; display: flex; align-items: center; }
        .currency-symbol { position: absolute; left: 12px; color: #64748b; z-index: 2; }
        
        input[type="number"] {
            width: 100%;
            background: #0f172a;
            border: 1px solid #475569;
            padding: 12px 12px 12px 30px;
            border-radius: 8px;
            color: #fff;
            font-size: 1.1rem;
            box-sizing: border-box;
            transition: border 0.2s;
        }
        input[type="number"]:focus { outline: none; border-color: var(--accent-blue); }

        .secret-content { transition: filter 0.3s; }
        .blur-overlay { filter: blur(10px); user-select: none; pointer-events: none; }
        .revealed { filter: blur(0); pointer-events: auto; }
        
        .toggle-eye {
            position: absolute; right: 0; top: -25px;
            background: none; border: none; cursor: pointer;
            font-size: 1.1rem; color: var(--accent-blue);
            z-index: 10; display: flex; align-items: center; gap: 5px;
        }
        .toggle-eye:hover { text-decoration: underline; }

        .result-tag { display: inline-block; margin-top: 10px; font-size: 0.9rem; font-weight: bold; min-height: 20px; }
        .tag-win { color: var(--accent-green); }
        .tag-loss { color: var(--accent-pink); }

        /* --- éª°å­åŠ¨ç”» --- */
        .dice-stage {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
        }

        .dice-wrapper { display: flex; gap: 40px; perspective: 800px; }

        .cube {
            width: var(--dice-size); height: var(--dice-size);
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(0deg) rotateY(0deg);
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .face {
            position: absolute; width: 100%; height: 100%;
            background: #f1f5f9; border-radius: 12px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
            border: 1px solid #cbd5e1;
            display: grid; grid-template: repeat(3, 1fr) / repeat(3, 1fr);
            padding: 6px; box-sizing: border-box;
        }

        .dot { background: #1e293b; border-radius: 50%; width: 16px; height: 16px; margin: auto; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.5); }
        .face[data-val="1"] .dot, .face[data-val="4"] .dot { background: #ef4444; } 
        .face[data-val="1"] .dot { width: 24px; height: 24px; }

        .front  { transform: rotateY(0deg) translateZ(40px); }
        .back   { transform: rotateY(180deg) translateZ(40px); }
        .right  { transform: rotateY(90deg) translateZ(40px); }
        .left   { transform: rotateY(-90deg) translateZ(40px); }
        .top    { transform: rotateX(90deg) translateZ(40px); }
        .bottom { transform: rotateX(-90deg) translateZ(40px); }

        .action-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none; padding: 16px 60px;
            border-radius: 50px; color: white;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .action-btn:hover { box-shadow: 0 15px 35px rgba(245, 158, 11, 0.4); transform: translateY(-2px); }
        .action-btn:active { transform: translateY(2px); }
        .action-btn:disabled { background: #475569; box-shadow: none; cursor: not-allowed; opacity: 0.7; }

        /* --- å›¾è¡¨ --- */
        .chart-box {
            width: 100%; max-width: 1000px; height: 350px;
            background: var(--panel-bg);
            border: 1px solid #334155; border-radius: 16px;
            padding: 15px; box-sizing: border-box;
            position: relative;
        }
        canvas { width: 100%; height: 100%; }

    </style>
</head>
<body>

    <div class="header-bar">
        <div class="title-group">
            <h1>ğŸ² å‡¯åˆ©å…¬å¼ vs ç›´è§‰ (åŒéª°ç‰ˆ)</h1>
            <p class="subtitle">v2.1 æ¦‚ç‡åˆ†å¸ƒä¸èµ„é‡‘ç®¡ç†å®æˆ˜</p>
        </div>
        
        <div class="status-group">
            <div class="round-badge">
                ç¬¬ <span id="currentRoundDisplay">0</span> è½®
            </div>
            <button class="reset-btn" onclick="resetGame()">
                <span>ğŸ”„</span> é‡ç½®
            </button>
        </div>
    </div>

    <!-- 1. è§„åˆ™è®¾ç½®åŒº -->
    <div class="settings-card">
        <div class="prob-header">
            <span style="font-weight:bold; color:#cbd5e1;">ğŸ¯ ç‚¹å‡»é€‰æ‹©â€œè·èƒœç‚¹æ•°â€ (2-12)</span>
            <span id="winRateBadge" class="win-rate-badge">èƒœç‡: 0.0%</span>
        </div>
        
        <div class="number-selector" id="numSelector">
            <!-- ç”± JS ç”Ÿæˆ -->
        </div>
        <div style="text-align:center; font-size:0.8rem; color:#64748b; margin-top:10px;">
            æç¤º: 7å‡ºç°æ¦‚ç‡æœ€é«˜(6/36)ï¼Œ2å’Œ12æœ€ä½(1/36)
        </div>
    </div>

    <!-- 2. ç©å®¶æ§åˆ¶åŒº -->
    <div class="players-grid">
        <!-- å‡¯åˆ© -->
        <div class="player-card card-kelly">
            <div class="p-header">
                <span class="p-name"><span style="color:var(--accent-blue)">ğŸ¤–</span> å‡¯åˆ© (å‚è€ƒç­”æ¡ˆ)</span>
                <span class="p-balance" id="bal-kelly">1,000</span>
            </div>
            <div class="bet-container">
                <button class="toggle-eye" onclick="toggleKelly()">
                    <span id="eye-icon">ğŸ‘ï¸</span> <span id="eye-text">æŸ¥çœ‹ç­”æ¡ˆ</span>
                </button>
                <div id="kelly-secret-area" class="secret-content blur-overlay">
                    <label class="bet-label">å»ºè®®é‡‘é¢:</label>
                    <div class="input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="number" id="bet-kelly" disabled>
                    </div>
                    <div id="kelly-msg" style="font-size:0.8rem; color:#64748b; margin-top:5px; min-height:1.2em; font-weight:bold;">è®¡ç®—ä¸­...</div>
                </div>
            </div>
            <div class="result-tag" id="res-kelly"></div>
        </div>

        <!-- å¥³å„¿ -->
        <div class="player-card card-daughter">
            <div class="p-header">
                <span class="p-name"><span style="color:var(--accent-pink)">ğŸ‘§</span> å¥³å„¿ (ä½ )</span>
                <span class="p-balance" id="bal-daughter">1,000</span>
            </div>
            <div class="bet-container">
                <label class="bet-label">ä½ è¦æŠ•å¤šå°‘?</label>
                <div class="input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" id="bet-daughter" placeholder="0">
                </div>
                <div style="font-size:0.8rem; color:#64748b; margin-top:5px;">å…ˆæ€è€ƒï¼Œå†ä¸‹æ³¨</div>
            </div>
            <div class="result-tag" id="res-daughter"></div>
        </div>

        <!-- çˆ¸çˆ¸ -->
        <div class="player-card card-father">
            <div class="p-header">
                <span class="p-name"><span style="color:var(--accent-green)">ğŸ‘¨</span> çˆ¸çˆ¸ (é™ªç»ƒ)</span>
                <span class="p-balance" id="bal-father">1,000</span>
            </div>
            <div class="bet-container">
                <label class="bet-label">çˆ¸çˆ¸æŠ•å¤šå°‘?</label>
                <div class="input-wrapper">
                    <span class="currency-symbol">$</span>
                    <input type="number" id="bet-father" placeholder="0">
                </div>
                <div style="font-size:0.8rem; color:#64748b; margin-top:5px;">ä½œä¸ºå¯¹ç…§ç»„</div>
            </div>
            <div class="result-tag" id="res-father"></div>
        </div>
    </div>

    <!-- 3. åŠ¨ç”»ä¸æ“ä½œåŒº -->
    <div class="dice-stage">
        <div class="dice-wrapper">
            <div class="cube" id="die1"></div>
            <div class="cube" id="die2"></div>
        </div>
        <button class="action-btn" id="rollBtn" onclick="startRound()">ğŸ² æŠ•æ· (Roll)</button>
        <div style="font-size:1.5rem; font-weight:bold; color:#fff; height:30px;" id="roundResultText"></div>
    </div>

    <!-- 4. å›¾è¡¨åŒº -->
    <div class="chart-box">
        <canvas id="gameChart"></canvas>
    </div>

    <script>
        const PROBS = { 2:1, 3:2, 4:3, 5:4, 6:5, 7:6, 8:5, 9:4, 10:3, 11:2, 12:1 };
        const TOTAL_COMBINATIONS = 36;
        const INITIAL_BALANCE = 1000;
        
        let winningNumbers = [6, 7, 8]; 
        let players = {}; 
        let currentRound = 0; // è½®æ•°è®¡æ•°å™¨

        const ROTATIONS = {
            1: {x: 0, y: 0}, 6: {x: 180, y: 0},
            2: {x: 0, y: 90}, 5: {x: 0, y: -90},
            3: {x: -90, y: 0}, 4: {x: 90, y: 0}
        };

        window.onload = function() {
            renderNumberSelector();
            createDiceFaces('die1');
            createDiceFaces('die2');
            initGameData();
            
            ['daughter', 'father'].forEach(p => {
                const input = document.getElementById(`bet-${p}`);
                input.addEventListener('input', function() {
                    let max = players[p].balance;
                    if(parseFloat(this.value) > max) this.value = max;
                    if(parseFloat(this.value) < 0) this.value = 0;
                });
            });
        };

        function initGameData() {
            players = {
                kelly: { balance: INITIAL_BALANCE, history: [INITIAL_BALANCE], color: '#3b82f6' },
                daughter: { balance: INITIAL_BALANCE, history: [INITIAL_BALANCE], color: '#ec4899' },
                father: { balance: INITIAL_BALANCE, history: [INITIAL_BALANCE], color: '#10b981' }
            };
            currentRound = 0;
            document.getElementById('currentRoundDisplay').innerText = currentRound;

            updateUIBalances();
            updateGameState();
            drawChart();
            
            document.getElementById('roundResultText').innerText = "";
            ['kelly', 'daughter', 'father'].forEach(p => {
                document.getElementById(`res-${p}`).innerText = "";
            });
            document.getElementById('bet-daughter').value = "";
            document.getElementById('bet-father').value = "";
        }

        function resetGame() {
            if(confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿæ‰€æœ‰èµ„é‡‘å°†æ¢å¤ä¸º 1,000ã€‚")) {
                initGameData();
                if(isKellyRevealed) toggleKelly(); 
            }
        }

        let isKellyRevealed = false;
        function toggleKelly() {
            const area = document.getElementById('kelly-secret-area');
            const icon = document.getElementById('eye-icon');
            const text = document.getElementById('eye-text');
            isKellyRevealed = !isKellyRevealed;
            if(isKellyRevealed) {
                area.classList.remove('blur-overlay'); area.classList.add('revealed');
                icon.innerText = 'ğŸ”’'; text.innerText = 'éšè—ç­”æ¡ˆ';
            } else {
                area.classList.add('blur-overlay'); area.classList.remove('revealed');
                icon.innerText = 'ğŸ‘ï¸'; text.innerText = 'æŸ¥çœ‹ç­”æ¡ˆ';
            }
        }

        function renderNumberSelector() {
            const container = document.getElementById('numSelector');
            container.innerHTML = '';
            for(let i=2; i<=12; i++) {
                const btn = document.createElement('div');
                const isActive = winningNumbers.includes(i);
                btn.className = `num-btn ${isActive ? 'active' : ''}`;
                let dots = "â€¢".repeat(PROBS[i]);
                btn.innerHTML = `<span>${i}</span><div class="dots">${dots}</div>`;
                btn.onclick = () => toggleNumber(i);
                container.appendChild(btn);
            }
        }

        function toggleNumber(num) {
            if(winningNumbers.includes(num)) winningNumbers = winningNumbers.filter(n => n !== num);
            else winningNumbers.push(num);
            renderNumberSelector();
            updateGameState();
            if(isKellyRevealed) toggleKelly();
        }

        function updateGameState() {
            let winCombinations = 0;
            winningNumbers.forEach(n => winCombinations += PROBS[n]);
            const winRate = winCombinations / TOTAL_COMBINATIONS;
            const winRatePct = (winRate * 100).toFixed(1);
            
            const badge = document.getElementById('winRateBadge');
            badge.innerText = `èƒœç‡: ${winRatePct}%`;
            badge.className = winRate > 0.5 ? 'win-rate-badge' : 'win-rate-badge bad';

            const kellyFraction = (2 * winRate) - 1;
            const kellyInput = document.getElementById('bet-kelly');
            const kellyMsg = document.getElementById('kelly-msg');
            
            if(players.kelly.balance <= 0) {
                kellyInput.value = 0; kellyMsg.innerText = "å·²ç ´äº§";
            } else if(kellyFraction <= 0) {
                kellyInput.value = 0; kellyMsg.innerText = "å»ºè®®: ä¸ä¸‹æ³¨ (åŠ£åŠ¿)"; kellyMsg.style.color = "#ec4899";
            } else {
                const bet = Math.floor(players.kelly.balance * kellyFraction);
                kellyInput.value = bet; kellyMsg.innerText = `å»ºè®®ä»“ä½: ${(kellyFraction*100).toFixed(0)}% (ä¼˜åŠ¿)`; kellyMsg.style.color = "#10b981";
            }
        }

        const DOT_MAP = {
            1: [[0,0,0],[0,1,0],[0,0,0]], 2: [[1,0,0],[0,0,0],[0,0,1]],
            3: [[1,0,0],[0,1,0],[0,0,1]], 4: [[1,0,1],[0,0,0],[1,0,1]],
            5: [[1,0,1],[0,1,0],[1,0,1]], 6: [[1,0,1],[1,0,1],[1,0,1]]
        };

        function createDiceFaces(dieId) {
            const die = document.getElementById(dieId);
            const faces = [
                {c:'front', v:1}, {c:'back', v:6}, {c:'right', v:5}, 
                {c:'left', v:2}, {c:'top', v:3}, {c:'bottom', v:4}
            ];
            faces.forEach(f => {
                const div = document.createElement('div'); div.className = `face ${f.c}`; div.setAttribute('data-val', f.v);
                DOT_MAP[f.v].flat().forEach(hasDot => {
                    const dotWrap = document.createElement('div');
                    if(hasDot) { const d = document.createElement('div'); d.className = 'dot'; dotWrap.appendChild(d); }
                    div.appendChild(dotWrap);
                });
                die.appendChild(div);
            });
        }

        function animateDie(dieId, val) {
            const die = document.getElementById(dieId);
            const target = ROTATIONS[val];
            const finalX = target.x + 1080; const finalY = target.y + 720;
            die.style.transition = 'none'; die.style.transform = 'rotateX(0deg) rotateY(0deg)';
            setTimeout(() => {
                die.style.transition = 'transform 1.2s cubic-bezier(0.15, 0.9, 0.34, 1)';
                die.style.transform = `rotateX(${finalX}deg) rotateY(${finalY}deg)`;
            }, 50);
        }

        function startRound() {
            if(players.daughter.balance <= 0 && players.father.balance <=0) { alert("æ¸¸æˆç»“æŸï¼"); return; }
            const btn = document.getElementById('rollBtn');
            const resText = document.getElementById('roundResultText');
            
            const bets = {
                kelly: parseInt(document.getElementById('bet-kelly').value) || 0,
                daughter: parseInt(document.getElementById('bet-daughter').value) || 0,
                father: parseInt(document.getElementById('bet-father').value) || 0
            };

            btn.disabled = true;
            resText.innerText = "";
            ['kelly', 'daughter', 'father'].forEach(p => { document.getElementById(`res-${p}`).innerText = ""; });

            const d1 = Math.floor(Math.random()*6)+1;
            const d2 = Math.floor(Math.random()*6)+1;
            const sum = d1 + d2;
            const isWin = winningNumbers.includes(sum);

            animateDie('die1', d1); animateDie('die2', d2);

            setTimeout(() => {
                currentRound++; // å¢åŠ è½®æ•°
                document.getElementById('currentRoundDisplay').innerText = currentRound;

                resText.innerText = `${d1} + ${d2} = ${sum} ${isWin ? 'âœ… èµ¢' : 'âŒ è¾“'}`;
                resText.style.color = isWin ? 'var(--accent-green)' : 'var(--accent-pink)';

                updateBalance('kelly', bets.kelly, isWin);
                updateBalance('daughter', bets.daughter, isWin);
                updateBalance('father', bets.father, isWin);

                drawChart();
                updateGameState(); 
                btn.disabled = false;
            }, 1250);
        }

        function updateBalance(playerKey, bet, isWin) {
            const p = players[playerKey];
            const elRes = document.getElementById(`res-${playerKey}`);
            if(bet <= 0) { elRes.innerText = "æœªä¸‹æ³¨"; elRes.style.color = "#64748b"; } 
            else if (isWin) { p.balance += bet; elRes.innerText = `+${bet}`; elRes.className = "result-tag tag-win"; } 
            else { p.balance -= bet; elRes.innerText = `-${bet}`; elRes.className = "result-tag tag-loss"; }
            p.history.push(p.balance);
            updateUIBalances();
        }

        function updateUIBalances() {
            document.getElementById('bal-kelly').innerText = players.kelly.balance.toLocaleString();
            document.getElementById('bal-daughter').innerText = players.daughter.balance.toLocaleString();
            document.getElementById('bal-father').innerText = players.father.balance.toLocaleString();
        }

        function drawChart() {
            const canvas = document.getElementById('gameChart');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
            const w = canvas.width; const h = canvas.height;

            ctx.clearRect(0, 0, w, h);

            let allVals = [...players.kelly.history, ...players.daughter.history, ...players.father.history];
            let max = Math.max(1500, ...allVals);
            let min = Math.min(0, ...allVals);
            let steps = players.kelly.history.length;
            
            const padTop = 20; const padBot = 40; // å¢åŠ åº•éƒ¨è¾¹è·ç»™Xè½´æ–‡å­—
            const padLeft = 40; const padRight = 30;
            const graphH = h - padTop - padBot;
            const graphW = w - padLeft - padRight;

            // ç»˜åˆ¶ç½‘æ ¼çº¿å’ŒXè½´è½®æ•°
            ctx.strokeStyle = '#334155';
            ctx.fillStyle = '#64748b';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.lineWidth = 1;

            // X è½´æ ‡ç­¾
            const labelInterval = steps > 20 ? 5 : 1; 
            for(let i=0; i<steps; i++) {
                if(i % labelInterval !== 0 && i !== steps-1) continue;
                const x = padLeft + (i / (steps - 1 || 1)) * graphW;
                
                // ç½‘æ ¼ç«–çº¿
                ctx.beginPath();
                ctx.moveTo(x, padTop); ctx.lineTo(x, h - padBot);
                ctx.strokeStyle = 'rgba(51, 65, 85, 0.3)';
                ctx.stroke();

                // è½®æ•°æ–‡å­—
                ctx.fillText(i, x, h - 10);
            }
            
            // 0 èµ„é‡‘æ°´å¹³çº¿
            const zeroY = padTop + graphH - ((1000 - min) / (max - min)) * graphH;
            ctx.beginPath();
            ctx.strokeStyle = '#475569';
            ctx.setLineDash([5, 5]);
            ctx.moveTo(padLeft, zeroY); ctx.lineTo(w - padRight, zeroY);
            ctx.stroke();
            ctx.setLineDash([]);

            function drawLine(history, color) {
                ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 3; ctx.lineJoin = 'round';
                history.forEach((val, i) => {
                    const x = padLeft + (i / (steps - 1 || 1)) * graphW;
                    const y = padTop + graphH - ((val - min) / (max - min)) * graphH;
                    if(i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                });
                ctx.stroke();
                if(history.length > 0) {
                    const lastVal = history[history.length-1];
                    const x = padLeft + graphW;
                    const y = padTop + graphH - ((lastVal - min) / (max - min)) * graphH;
                    ctx.fillStyle = color; ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI*2); ctx.fill();
                }
            }

            drawLine(players.kelly.history, players.kelly.color);
            drawLine(players.daughter.history, players.daughter.color);
            drawLine(players.father.history, players.father.color);
            
            // Yè½´æ ‡é¢˜
            ctx.save();
            ctx.translate(15, h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillStyle = '#94a3b8';
            ctx.fillText("èµ„äº§å‡€å€¼", 0, 0);
            ctx.restore();
            // Xè½´æ ‡é¢˜
            ctx.fillText("è½®æ•° (Round)", w/2, h-5);
        }
    </script>
</body>
</html>