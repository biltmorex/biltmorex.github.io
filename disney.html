<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¿ªå£«å°¼æ¢¦å¹»å¤§å¯Œç¿ - å¥‡å¦™å†’é™©ç‰ˆ</title>
    <style>
        :root {
            --p1-color: #9b59b6;
            --p2-color: #ff69b4;
            --board-bg: #fff0f5;
            --cell-bg: #fff;
            --font-main: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            width: 98vw;
            max-width: 1100px;
            height: 96vh; 
            max-height: 850px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            box-shadow: 0 15px 50px rgba(100, 50, 100, 0.4);
            display: grid;
            grid-template-columns: 270px 1fr;
            padding: 20px;
            gap: 20px;
            box-sizing: border-box;
            position: relative;
            border: 5px solid #fff;
        }

        /* --- å·¦ä¾§é¢æ¿ --- */
        #control-panel {
            background: #fff;
            padding: 15px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: 100%;
            box-sizing: border-box;
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.2);
            overflow: hidden;
            border: 2px solid #f8bbd0;
        }

        .game-status {
            background: #8e44ad; color: #fff; padding: 12px; border-radius: 15px; font-size: 13px; margin-bottom: 5px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .progress-bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; margin-top: 6px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: #ffd700; width: 0%; transition: width 0.5s; box-shadow: 0 0 5px #ffd700; }

        .player-card {
            padding: 12px; border-radius: 15px; border: 3px solid #fce4ec; background: #fff; transition: all 0.3s; flex-shrink: 0;
        }
        .player-card.active {
            border-color: #ff69b4; background-color: #fff0f5; transform: scale(1.03); box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
        }
        .money-display { font-size: 22px; color: #e91e63; font-family: 'Consolas', monospace; font-weight: bold; text-shadow: 1px 1px 0 #fad0c4; }
        
        #log-box {
            flex-grow: 1; overflow-y: auto; font-size: 13px; border-top: 2px dashed #f8bbd0; padding-top: 8px; color: #666; line-height: 1.6; min-height: 50px;
        }

        #action-area {
            margin-top: auto; height: 140px; position: relative; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; perspective: 600px; flex-shrink: 0; border-top: 2px solid #f8bbd0; padding-top: 10px;
        }

        /* --- 3Déª°å­ --- */
        .cube-wrapper { width: 50px; height: 50px; position: absolute; top: 10px; transform-style: preserve-3d; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1.2s cubic-bezier(0.1, 0.6, 0.3, 1); }
        .cube-face { position: absolute; width: 50px; height: 50px; background: #fff; border: 2px solid #ff69b4; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 22px; font-weight: bold; color: #e91e63; backface-visibility: hidden; box-shadow: inset 0 0 10px rgba(255,105,180,0.2); }
        
        .face-1 { transform: rotateY(0deg) translateZ(25px); }
        .face-2 { transform: rotateY(90deg) translateZ(25px); }
        .face-3 { transform: rotateX(-90deg) translateZ(25px); } 
        .face-4 { transform: rotateX(90deg) translateZ(25px); }  
        .face-5 { transform: rotateY(-90deg) translateZ(25px); }
        .face-6 { transform: rotateY(180deg) translateZ(25px); }
        .face-1::after { content: "ğŸ‘‘"; font-size: 24px;} 
        .face-2::after { content: "2"; } .face-3::after { content: "3"; } .face-4::after { content: "4"; } .face-5::after { content: "5"; } .face-6::after { content: "6"; }

        .roll-btn {
            background: linear-gradient(to bottom, #ff69b4, #e91e63); color: white; border: none; padding: 12px 0; width: 90%; font-size: 18px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #c2185b; margin-top: 70px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .roll-btn:disabled { background: #b2bec3; cursor: not-allowed; box-shadow: none; transform: translateY(3px); }

        /* --- å³ä¾§æ£‹ç›˜ (6x6) --- */
        #board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 10px;
            position: relative;
            padding: 15px;
            background: #fff0f5;
            border-radius: 20px;
            border: 3px solid #f8bbd0;
            height: 100%; box-sizing: border-box;
        }

        .cell {
            background: var(--cell-bg); border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 12px; position: relative; text-align: center; font-weight: bold; box-shadow: 0 3px 0 #f48fb1; padding: 2px; overflow: hidden; min-height: 0; border: 1px solid #ffebee;
        }
        .cell-icon { font-size: 26px; margin-bottom: 2px; line-height: 1; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); }
        .cell-name { font-size: 12px; color: #880e4f; white-space: nowrap; }
        .cell-info { font-size: 10px; color: #ad1457; transform: scale(0.9); white-space: nowrap; }
        
        /* é¢œè‰² */
        .t-start { background: #dcedc8; border-bottom: 3px solid #8bc34a; }
        .t-city  { border-bottom: 3px solid #42a5f5; }
        .t-bad   { background: #ffcdd2; border-bottom: 3px solid #e57373; }
        .t-luck  { background: #fff9c4; border-bottom: 3px solid #fdd835; }
        .t-policy{ background: #e1bee7; border-bottom: 3px solid #ba68c8; }
        .t-school{ background: #b2dfdb; border-bottom: 3px solid #4db6ac; }
        .t-trap  { background: #cfd8dc; color: #555; border-bottom: 3px solid #78909c; }
        .t-quiz  { background: #bbdefb; border-bottom: 3px solid #64b5f6; }
        .t-fun   { background: #ffe0b2; border-bottom: 3px solid #ffb74d; } /* è¶£å‘³äº’åŠ¨ */

        .token-container { width: 35px; height: 55px; position: absolute; z-index: 20; transition: top 0.3s linear, left 0.3s linear; pointer-events: none; display: flex; justify-content: center; align-items: flex-end; }
        .character-sprite { font-size: 40px; line-height: 1; transform-origin: bottom center; transition: transform 0.2s; filter: drop-shadow(0 4px 3px rgba(0,0,0,0.2)); }
        @keyframes walk-anim { 0%, 100% { transform: translateY(0) scaleX(var(--face-dir, 1)); } 50% { transform: translateY(-10px) scaleX(var(--face-dir, 1)); } }
        .walking .character-sprite { animation: walk-anim 0.25s infinite; }

        /* --- ä»ªè¡¨ç›˜ --- */
        .center-area {
            grid-column: 2 / 6; grid-row: 2 / 6; 
            background: linear-gradient(to bottom, #f3e5f5, #e1bee7);
            border-radius: 50% 50% 20px 20px / 20px 20px 20px 20px;
            display: grid;
            grid-template-rows: 45px 1fr 60px;
            color: #4a148c;
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.3);
            overflow: hidden;
            border: 4px solid #ce93d8;
        }
        .center-header { background: #ba68c8; color: white; display: flex; align-items: center; justify-content: center; font-size: 15px; font-weight: bold; letter-spacing: 1px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .center-content { padding: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .center-footer { background: #f8bbd0; padding: 5px 15px; font-size: 11px; color: #880e4f; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #f48fb1; }
        .kelly-viz { font-size: 20px; font-family: 'Comic Sans MS', cursive; color: #e91e63; margin: 10px 0; background: rgba(255,255,255,0.6); padding: 5px 15px; border-radius: 15px; }
        .market-msg { font-size: 14px; color: #6a1b9a; margin-top: 5px; min-height: 20px;}
        .big-icon { font-size: 45px; margin-bottom: 5px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));}

        /* --- å¼¹çª—ä½“ç³» --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(74, 20, 140, 0.6); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal-box { background: #fff; padding: 25px; border-radius: 25px; width: 420px; text-align: center; box-shadow: 0 0 0 5px #f8bbd0, 0 20px 50px rgba(0,0,0,0.5); animation: popIn 0.3s ease; position: relative; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .start-option { background: #fce4ec; border: 2px solid #fff; padding: 15px; margin: 10px 0; border-radius: 15px; cursor: pointer; transition: 0.2s; text-align: left; display: flex; align-items: center; justify-content: space-between; }
        .start-option:hover, .start-option.selected { border-color: #ff69b4; background: #fff0f5; transform: scale(1.02); }
        .custom-input { width: 80px; padding: 5px; border: 2px solid #f48fb1; border-radius: 10px; font-size: 14px; margin-left: 10px; text-align: center; color: #e91e63;}

        .quiz-question { font-size: 17px; font-weight: bold; margin-bottom: 20px; text-align: left; line-height: 1.5; color: #880e4f; }
        .quiz-btn { display: block; width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #f8bbd0; background: #fff; border-radius: 12px; cursor: pointer; text-align: left; font-size: 15px; transition: 0.2s; color: #4a148c; }
        .quiz-btn:hover { background: #fce4ec; border-color: #ff69b4; }
        .quiz-result-good { color: #27ae60; font-weight: bold; margin-top: 15px; font-size: 16px; }
        .quiz-result-bad { color: #e74c3c; font-weight: bold; margin-top: 15px; font-size: 16px; }

        .winner-trophy { font-size: 70px; margin-bottom: 10px; display:block; animation: float 2s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .stat-result { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f3e5f5; border-radius: 10px; font-weight: bold; color: #4a148c; }

        .btn-main { background: linear-gradient(to right, #ba68c8, #ff69b4); color: white; width: 100%; padding: 12px; border:none; border-radius: 20px; font-size: 18px; cursor: pointer; font-weight: bold; margin-top: 15px; box-shadow: 0 4px 10px rgba(186, 104, 200, 0.4); transition: transform 0.1s;}
        .btn-main:active { transform: scale(0.98); }
        input[type="range"] { width: 100%; margin: 15px 0; accent-color: #ff69b4; }
        .btn-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .btn-opt { padding: 8px; font-size: 12px; border: none; border-radius: 8px; cursor: pointer; color: white; background: #ce93d8; font-weight: bold; }
        .trade-info { background: #f3e5f5; padding: 15px; border-radius: 12px; margin: 10px 0; text-align: left; border: 1px solid #e1bee7;}

    </style>
</head>
<body>

<div id="game-container">
    <!-- å·¦ä¾§ -->
    <div id="control-panel">
        <div class="game-status">
            <div style="display:flex; justify-content:space-between;">
                <span>ğŸ¯ ç›®æ ‡: <span id="goal-text">50,000</span></span>
                <span id="turn-text">Round: 1</span>
            </div>
            <div class="progress-bar-bg" title="P1è¿›åº¦">
                <div id="p1-progress" class="progress-bar-fill" style="background:#9b59b6"></div>
            </div>
            <div class="progress-bar-bg" title="P2è¿›åº¦">
                <div id="p2-progress" class="progress-bar-fill" style="background:#ff69b4"></div>
            </div>
        </div>
        
        <div id="p1-card" class="player-card active">
            <div style="display:flex; justify-content:space-between; align-items:center">
                <span>ğŸ¤´ ç‹å­ (çˆ¸çˆ¸)</span>
                <span id="p1-money" class="money-display">10000</span>
            </div>
            <div id="p1-buff" style="font-size:10px; color:#8e44ad; height:12px;"></div>
        </div>

        <div id="p2-card" class="player-card">
            <div style="display:flex; justify-content:space-between; align-items:center">
                <span>ğŸ‘¸ å…¬ä¸» (å¥³å„¿)</span>
                <span id="p2-money" class="money-display">10000</span>
            </div>
            <div id="p2-buff" style="font-size:10px; color:#8e44ad; height:12px;"></div>
        </div>

        <div id="log-box"></div>

        <div id="action-area">
            <div class="cube-wrapper">
                <div class="cube" id="dice-cube">
                    <div class="cube-face face-1"></div>
                    <div class="cube-face face-2"></div>
                    <div class="cube-face face-3"></div>
                    <div class="cube-face face-4"></div>
                    <div class="cube-face face-5"></div>
                    <div class="cube-face face-6"></div>
                </div>
            </div>
            <button class="roll-btn" id="roll-btn" onclick="rollDice()">ğŸ² æ·å‡ºé­”æ³•éª°å­</button>
        </div>
    </div>

    <!-- å³ä¾§ -->
    <div id="board">
        <div class="center-area">
            <div class="center-header">
                âœ¨ é­”é•œåˆ†æ (MAGIC MIRROR)
            </div>
            <div class="center-content">
                <div id="center-icon" class="big-icon">ğŸ°</div>
                <div id="center-title" style="font-size:18px; font-weight:bold; color:#880e4f">æ¢…æ—é­”æ³•å…¬å¼</div>
                <div class="kelly-viz">f* = 2p - 1</div>
                <div id="center-desc" class="market-msg">ç­‰å¾…å†’é™©å¼€å§‹...</div>
            </div>
            <div class="center-footer">
                <span>ğŸŸ¢ èƒœç‡é«˜: <b>å‹‡æ•¢æŠ•èµ„</b></span>
                <span>ğŸ”´ èƒœç‡ä½: <b>å°å¿ƒé™·é˜±</b></span>
            </div>
        </div>
        
        <div id="p1-token" class="token-container"><div class="character-sprite">ğŸ¤´</div></div>
        <div id="p2-token" class="token-container"><div class="character-sprite">ğŸ‘¸</div></div>
    </div>
</div>

<!-- å¼€å±€è®¾ç½®å¼¹çª— -->
<div id="modal-start" class="modal-overlay" style="display:flex;">
    <div class="modal-box" style="background: #fff0f5;">
        <h2 style="color:#880e4f">ğŸ° å¼€å¯ç«¥è¯å†’é™©</h2>
        
        <div class="start-option selected" onclick="selectMode(1, this)">
            <div>
                <h4 style="margin:0; color:#c2185b">ğŸ† ç«é€Ÿæ¨¡å¼</h4>
                <p style="margin:0; font-size:12px; color:#888">èµšå–é‡‘å¸ç›®æ ‡:</p>
            </div>
            <input type="number" id="input-target" class="custom-input" value="50000" step="10000" onclick="event.stopPropagation()">
        </div>

        <div class="start-option" onclick="selectMode(2, this)">
            <div>
                <h4 style="margin:0; color:#7b1fa2">â±ï¸ é™æ—¶æ¨¡å¼</h4>
                <p style="margin:0; font-size:12px; color:#888">å†’é™©å›åˆæ•°:</p>
            </div>
            <input type="number" id="input-rounds" class="custom-input" value="20" step="10" onclick="event.stopPropagation()">
        </div>

        <div class="start-option" onclick="selectMode(3, this)">
            <div>
                <h4 style="margin:0; color:#e64a19">ğŸ¢ ç”Ÿå­˜æ¨¡å¼</h4>
                <p style="margin:0; font-size:12px; color:#888">ç›´åˆ°æœ‰äººé‡‘å¸è€—å°½</p>
            </div>
        </div>

        <button class="btn-main" onclick="startGame()">âœ¨ è¿›å…¥é­”æ³•ä¸–ç•Œ</button>
    </div>
</div>

<!-- æ¸¸æˆç»“æŸå¼¹çª— -->
<div id="modal-end" class="modal-overlay">
    <div class="modal-box" style="border-top: 5px solid #ffd700;">
        <span class="winner-trophy">ğŸ‘‘</span>
        <h2 id="end-title" style="margin:5px 0; color:#e91e63;">å†’é™©ç»“æŸ!</h2>
        <p id="end-reason" style="color:#880e4f;">åŸå› </p>
        
        <div style="margin-top:20px;">
            <div class="stat-result" style="border-left:5px solid #9b59b6">
                <span>ğŸ¤´ ç‹å­</span>
                <span id="end-p1-money">0</span>
            </div>
            <div class="stat-result" style="border-left:5px solid #ff69b4">
                <span>ğŸ‘¸ å…¬ä¸»</span>
                <span id="end-p2-money">0</span>
            </div>
        </div>

        <h3 id="winner-name" style="color:#e91e63; margin-top:15px;"></h3>
        <button class="btn-main" onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<!-- äº¤æ˜“å¼¹çª— -->
<div id="modal-trade" class="modal-overlay">
    <div class="modal-box">
        <h3 id="trade-title" style="margin:0; color:#880e4f">åœ°ç‚¹</h3>
        <div class="trade-info">
            <div style="display:flex; justify-content:space-between;">
                <span>ğŸ“ˆ æˆåŠŸç‡: <b id="trade-prob" style="color:#e67e22;">0%</b></span>
                <span style="font-size:12px; color:#999">ç›ˆäº Â±100%</span>
            </div>
            <div style="width:100%; height:8px; background:#fff; margin-top:5px; border-radius:4px; border:1px solid #ddd;">
                <div id="prob-bar" style="width:0%; height:100%; background:#ffd700; transition:width 0.5s;"></div>
            </div>
        </div>
        
        <div id="trade-input-ui">
            <p style="margin:5px 0; font-size:15px; color:#4a148c">æŠ•å…¥é‡‘å¸: <b id="invest-val" style="color:#e91e63; font-size:18px;">0 (0%)</b></p>
            <input type="range" id="invest-range" value="0" min="0" oninput="updateRangeUI()">
            
            <div class="btn-grid">
                <button class="btn-opt" onclick="setInvest(0.1)">10%</button>
                <button class="btn-opt" onclick="setInvest(0.2)">20%</button>
                <button class="btn-opt" onclick="setInvest(0.5)">50%</button>
                <button class="btn-opt" style="background:#ff4081" onclick="setInvest(1.0)">All</button>
            </div>
            <button class="btn-main" onclick="confirmTrade()">ğŸ’° ç¡®è®¤æŠ•èµ„</button>
        </div>
        <div id="trade-result"></div>
    </div>
</div>

<!-- é—®ç­”å¼¹çª— -->
<div id="modal-quiz" class="modal-overlay">
    <div class="modal-box">
        <div style="font-size:50px; margin-bottom:10px;">ğŸ§â€â™‚ï¸</div>
        <h3 style="margin:0 0 10px 0; color:#303f9f">ç¥ç¯ç²¾çµçš„è€ƒéªŒ</h3>
        <div class="quiz-question" id="quiz-q">é¢˜ç›®åŠ è½½ä¸­...</div>
        <div id="quiz-options"></div>
        <div id="quiz-feedback"></div>
        <button class="btn-main" id="quiz-close-btn" style="display:none; background:#b0bec5" onclick="closeQuizModal()">ç»§ç»­å†’é™©</button>
    </div>
</div>

<!-- ä¿¡æ¯å¼¹çª— -->
<div id="modal-info" class="modal-overlay">
    <div class="modal-box">
        <div id="info-icon" style="font-size:50px; margin-bottom:10px;">ğŸ</div>
        <h3 id="info-title" style="color:#880e4f">æ ‡é¢˜</h3>
        <p id="info-desc" style="font-size:15px; color:#555; margin:15px 0;">å†…å®¹</p>
        <button class="btn-main" onclick="closeInfoModal()">ç¡®å®š</button>
    </div>
</div>

<script>
    // --- é…ç½®ä¸çŠ¶æ€ ---
    const pathMap = [
        {r:1, c:1}, {r:1, c:2}, {r:1, c:3}, {r:1, c:4}, {r:1, c:5}, {r:1, c:6},
        {r:2, c:6}, {r:3, c:6}, {r:4, c:6}, {r:5, c:6}, {r:6, c:6},
        {r:6, c:5}, {r:6, c:4}, {r:6, c:3}, {r:6, c:2}, {r:6, c:1},
        {r:5, c:1}, {r:4, c:1}, {r:3, c:1}, {r:2, c:1}
    ];

    // --- è¿ªå£«å°¼ä¸»é¢˜åœ°å›¾æ•°æ® (ä¼˜åŒ–ç‰ˆ) ---
    // åªæœ‰ä¸€ä¸ªé™·é˜± (t-trap), å¢åŠ äº†ç½—å®¾æ±‰ã€ç¥ä»™æ•™æ¯ã€ç–¯å¸½å­
    const mapData = [
        { name: "åŸå ¡èµ·ç‚¹", type: "t-start", icon: "ğŸ°", info: "é›¶èŠ±é’±+2000" },
        { name: "ç½—å®¾æ±‰", type: "t-fun", icon: "ğŸ¹", info: "åŠ«å¯Œæµè´«" }, // æ–°å¢ï¼šå¹³è¡¡æœºåˆ¶
        { name: "é˜¿ä¼¦é»›å°”", type: "t-city", icon: "â„ï¸", industry: "å†°å—ç”Ÿæ„", minP:0.65, maxP:0.75 }, 
        { name: "ç¥ä»™æ•™æ¯", type: "t-luck", icon: "ğŸ§šâ€â™€ï¸", info: "è®¸ä¸ªæ„¿å§" }, // æ–°å¢ï¼šçº¯ç¦åˆ©
        { name: "ä»™å¥³è¯Šæ‰€", type: "t-bad", icon: "ğŸ¥", info: "æ²»ç–—è´¹-1000" },
        { name: "æ¯’è‹¹æœ", type: "t-trap", icon: "ğŸ", industry: "é»‘å¿ƒé­”è¯", minP:0.10, maxP:0.35 }, // å”¯ä¸€çš„åæŠ•èµ„
        { name: "ç–¯ç‹‚åŠ¨ç‰©åŸ", type: "t-city", icon: "ğŸ¦Š", industry: "çˆªçˆªå†°æ£", minP:0.65, maxP:0.85 },
        { name: "ç–¯å¸½å­èŒ¶ä¼š", type: "t-fun", icon: "ğŸ©", info: "ç–¯ç‹‚æ´¾å¯¹" }, // æ–°å¢ï¼šéšæœºäº‹ä»¶
        { name: "ç™¾äº©æ£®æ—", type: "t-city", icon: "ğŸ¯", industry: "èœ‚èœœè‚¡ç¥¨", minP:0.60, maxP:0.80 },
        { name: "è®¸æ„¿æ´ç©´", type: "t-city", icon: "ğŸº", industry: "å®è—çŒäºº", minP:0.55, maxP:0.90 }, // é«˜é£é™©é«˜å›æŠ¥
        { name: "åˆå¤œé’Ÿå£°", type: "t-bad", icon: "ğŸ•›", info: "é­”æ³•å¤±æ•ˆ-5%" }, 
        { name: "æ˜æ—¥ä¸–ç•Œ", type: "t-city", icon: "ğŸš€", industry: "æœªæ¥ç§‘æŠ€", minP:0.60, maxP:0.90 },
        { name: "ç¾å¥³ä¸é‡å…½", type: "t-city", icon: "ğŸŒ¹", industry: "ç«ç‘°èŠ±åº—", minP:0.60, maxP:0.80 },
        { name: "å›½ç‹çš„æ³•ä»¤", type: "t-policy", icon: "ğŸ“œ", info: "å…¨å‘˜äº‹ä»¶" }, 
        { name: "æ€ªå…½å¤§å­¦", type: "t-school", icon: "ğŸ«", info: "èƒœç‡UP" },
        { name: "ç¥ç¯é—®ç­”", type: "t-quiz", icon: "ğŸ§â€â™‚ï¸", info: "ç­”é¢˜èµ¢é‡‘å¸" }, 
        { name: "ä»™å±¥å¥‡ç¼˜", type: "t-city", icon: "ğŸ‘ ", industry: "æ°´æ™¶é‹", minP:0.55, maxP:0.75 },
        { name: "å¤§ç™½çš„æ‹¥æŠ±", type: "t-city", icon: "âšª", industry: "å¥åº·", minP:0.55, maxP:0.75 },
        { name: "ä¹Œè‹æ‹‰å¥‘çº¦", type: "t-bad", icon: "ğŸ™", info: "äº¤ç¨10%" },
        { name: "é£å±‹ç¯æ¸¸", type: "t-city", icon: "ğŸˆ", industry: "æ¢é™©", minP:0.60, maxP:0.75 },
    ];

    // --- é¢˜åº“ ---
    const quizBank = [
        { q: "å²é«˜æ²»å”å”(å”è€é¸­çš„èˆ…èˆ…)å–œæ¬¢åœ¨é‡‘å¸é‡Œæ¸¸æ³³ï¼Œå› ä¸ºä»–æ‡‚å¾—ï¼Ÿ", opts: ["ç§¯ç´¯è´¢å¯Œ", "æµªè´¹é’±", "å»æ¸¸æ³³"], ans: 0, why: "ç§¯ç´¯æœ¬é‡‘æ˜¯æŠ•èµ„çš„ç¬¬ä¸€æ­¥ã€‚" },
        { q: "å¦‚æœé˜¿æ‹‰ä¸æŠŠæ‰€æœ‰çš„æ„¿æœ›éƒ½ç”¨æ¥ä¹°é£æ¯¯ï¼Œè¿™å«ä»€ä¹ˆï¼Ÿ", opts: ["åˆ†æ•£æŠ•èµ„", "æŠŠé¸¡è›‹æ”¾ä¸€ä¸ªç¯®å­é‡Œ", "è®¸æ„¿"], ans: 1, why: "å…¨ä¹°ä¸€æ ·ä¸œè¥¿é£é™©å¾ˆé«˜ã€‚" },
        { q: "ç°å§‘å¨˜æ²¡æœ‰é’±ä¹°ç¤¼æœï¼Œç¥ä»™æ•™æ¯å˜å‡ºæ¥çš„ä¸œè¥¿å±äºï¼Ÿ", opts: ["åŠ³åŠ¨æ”¶å…¥", "æ„å¤–ä¹‹è´¢(è¿æ°”)", "å·¥èµ„"], ans: 1, why: "è¿æ°”ä¸å¯æŒç»­ï¼Œè¦é è‡ªå·±ã€‚" },
        { q: "åœ¨ç–¯ç‹‚åŠ¨ç‰©åŸï¼Œå¦‚æœå¤§å®¶éƒ½å»ä¹°â€˜çˆªçˆªå†°æ£â€™ï¼Œä»·æ ¼å¯èƒ½ä¼šï¼Ÿ", opts: ["å˜é«˜(ä¾›ä¸åº”æ±‚)", "å˜ä½", "ä¸å˜"], ans: 0, why: "éœ€æ±‚å¤§ï¼Œä»·æ ¼æ¶¨ã€‚" },
        { q: "å¦‚æœä½ æƒ³ä¹°è‰¾èçš„å†°é›ªåŸå ¡ï¼Œé’±ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿ", opts: ["æŠ¢è¿‡æ¥", "å­˜é’±å’ŒæŠ•èµ„", "å“­é—¹"], ans: 1, why: "ç†è´¢å¯ä»¥å¸®ä½ å®ç°ç›®æ ‡ã€‚" },
        { q: "å¦‚æœå·«å©†è¯´è¿™ä¸ªè‹¹æœèƒœç‡åªæœ‰30%èƒ½èµšé’±ï¼Œä½ åº”è¯¥ï¼Ÿ", opts: ["å…¨ä¹°", "ä¸ä¹°", "ä¹°ä¸€ç‚¹"], ans: 1, why: "èƒœç‡ä½å®¹æ˜“äºæœ¬ï¼ˆä¸­æ¯’ï¼‰ã€‚" },
        { q: "èŠ±æœ¨å…°æ›¿çˆ¶ä»å†›æ˜¯å› ä¸ºè´£ä»»ï¼ŒæŠ•èµ„ç†è´¢æ˜¯ä¸ºäº†ï¼Ÿ", opts: ["å¥½ç©", "è®©ç”Ÿæ´»æ›´è‡ªç”±ç¾å¥½", "å˜åäºº"], ans: 1, why: "è´¢å¯Œæ˜¯è®©ç”Ÿæ´»å˜å¥½çš„å·¥å…·ã€‚" }
    ];

    let players = [
        { id:0, name:"ç‹å­", money:10000, pos:0, el:null, card:null, buff:0 },
        { id:1, name:"å…¬ä¸»", money:10000, pos:0, el:null, card:null, buff:0 }
    ];
    let turn = 0;
    let roundCount = 1;
    let isAnimating = false;
    let currentDiceRot = {x:0, y:0};
    let currentTrade = null;
    let gameMode = 1; 
    let targetMoney = 50000;
    let maxRounds = 20;

    // --- æ¸¸æˆé€»è¾‘ ---
    function selectMode(mode, el) {
        gameMode = mode;
        document.querySelectorAll('.start-option').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
    }

    function startGame() {
        document.getElementById('modal-start').style.display = 'none';
        if(gameMode === 1) {
            let val = parseInt(document.getElementById('input-target').value);
            if(val && val > 0) targetMoney = val;
        } else if(gameMode === 2) {
            let val = parseInt(document.getElementById('input-rounds').value);
            if(val && val > 0) maxRounds = val;
        }

        initBoard();
        let conditionText = gameMode === 1 ? `ç›®æ ‡: ${targetMoney.toLocaleString()}` : (gameMode === 2 ? `é™æ—¶: ${maxRounds} å›åˆ` : "ç›´åˆ°ç ´äº§");
        let goalText = gameMode === 1 ? `ğŸ† ${targetMoney.toLocaleString()}` : (gameMode === 2 ? `â±ï¸ ${maxRounds} R` : "ğŸ’€ ç”Ÿå­˜");
        
        document.getElementById('goal-text').innerText = goalText;
        updateCenter("ğŸ°", "æ¬¢è¿æ¥åˆ°é­”æ³•ç‹å›½", conditionText);
        updateStatus();
    }

    function initBoard() {
        const board = document.getElementById('board');
        const decor = board.querySelector('.center-area');
        const p1Token = document.getElementById('p1-token');
        const p2Token = document.getElementById('p2-token');
        
        players[0].el = p1Token; players[1].el = p2Token;
        players[0].card = document.getElementById('p1-card');
        players[1].card = document.getElementById('p2-card');

        board.innerHTML = '';
        board.appendChild(decor);
        board.appendChild(p1Token);
        board.appendChild(p2Token);

        mapData.forEach((d, i) => {
            let div = document.createElement('div');
            div.className = `cell ${d.type}`;
            div.style.gridRow = pathMap[i].r;
            div.style.gridColumn = pathMap[i].c;
            div.innerHTML = `<div class="cell-icon">${d.icon}</div><div class="cell-name">${d.name}</div><div class="cell-info">${d.industry || d.info}</div>`;
            board.appendChild(div);
        });

        setTimeout(() => { placePlayer(players[0], 0); placePlayer(players[1], 0); }, 100);
        log("æ¬¢è¿æ¥åˆ°è¿ªå£«å°¼æ¢¦å¹»å¤§å¯Œç¿ï¼", "#e91e63");
    }

    // --- 3Déª°å­é€»è¾‘ ---
    const faceRotations = [
        { x: 0, y: 0 }, { x: 0, y: -90 }, { x: -90, y: 0 }, 
        { x: 90, y: 0 }, { x: 0, y: 90 }, { x: 0, y: 180 }
    ];

    function rollDice() {
        if(isAnimating) return;
        isAnimating = true;
        document.getElementById('roll-btn').disabled = true;

        const val = Math.floor(Math.random()*6)+1;
        const target = faceRotations[val-1];
        
        // ä¿®æ­£æ—‹è½¬ç´¯åŠ é€»è¾‘
        let loopsX = 3 + Math.floor(Math.random()*3);
        let loopsY = 3 + Math.floor(Math.random()*3);

        let nextX = currentDiceRot.x + (360 * loopsX);
        let remX = nextX % 360;
        let diffX = target.x - remX;
        if(diffX < 0) diffX += 360; nextX += diffX;

        let nextY = currentDiceRot.y + (360 * loopsY);
        let remY = nextY % 360;
        let diffY = target.y - remY;
        if(diffY < 0) diffY += 360; nextY += diffY;

        currentDiceRot = {x: nextX, y: nextY};
        document.getElementById('dice-cube').style.transform = `rotateX(${nextX}deg) rotateY(${nextY}deg)`;

        log(`${players[turn].name} æ­£åœ¨æ–½å±•éª°å­é­”æ³•...`);
        updateCenter("ğŸ²", "é­”æ³•éª°å­", "ç‚¹æ•°æ˜¯...");

        setTimeout(() => {
            log(`ğŸ² ç‚¹æ•°: <b>${val}</b>`);
            moveStep(players[turn], val);
        }, 1300);
    }

    function moveStep(p, steps) {
        let left = steps;
        p.el.classList.add('walking');
        let timer = setInterval(() => {
            let next = (p.pos + 1) % 20;
            if(next === 0 && p.pos === 19) {
                p.money += 2000;
                log(`ğŸ° ç»è¿‡åŸå ¡ï¼Œè·å¾—é›¶èŠ±é’±+2000`, '#e91e63');
                updateUI();
            }
            placePlayer(p, next, true);
            left--;
            if(left <= 0) {
                clearInterval(timer);
                p.el.classList.remove('walking');
                setTimeout(() => handleEvent(p), 300);
            }
        }, 250);
    }

    function placePlayer(p, idx, anim) {
        p.pos = idx;
        const cells = document.querySelectorAll('.cell');
        const cell = cells[idx];
        const cellRect = cell.getBoundingClientRect();
        const boardRect = document.getElementById('board').getBoundingClientRect();
        let cx = cellRect.left - boardRect.left + cellRect.width/2;
        let cy = cellRect.top - boardRect.top + cellRect.height/2;

        if(p.id===0) { cx -= 15; cy -= 5; } else { cx += 15; cy += 5; }
        if(anim) {
            let currC = pathMap[idx].c;
            let prevPos = (idx - 1 + 20) % 20;
            let prevC = pathMap[prevPos].c;
            if (currC > prevC) p.el.style.setProperty('--face-dir', 1);
            else if(currC < prevC) p.el.style.setProperty('--face-dir', -1);
        }
        p.el.style.left = (cx - 17) + 'px';
        p.el.style.top = (cy - 50) + 'px';
    }

    function handleEvent(p) {
        const d = mapData[p.pos];
        log(`${p.name} æ¥åˆ°äº† ${d.name}`);
        updateCenter(d.icon, d.name, d.industry || d.info);

        if(d.type === 't-city' || d.type === 't-risk' || d.type === 't-trap') {
            openTradeModal(d, p);
        } else if(d.name === "ç¥ç¯é—®ç­”") {
            openQuiz(p);
        } else if(d.name === "ç½—å®¾æ±‰") { // åŠ«å¯Œæµè´«
            let otherP = players[(p.id + 1) % 2];
            let diff = otherP.money - p.money;
            if(diff > 1000) {
                let gift = Math.floor(diff * 0.2);
                p.money += gift;
                otherP.money -= gift;
                showInfo("ğŸ¹ ç½—å®¾æ±‰", `åŠ«å¯Œæµè´«ï¼ä½ ä»å¯¹æ‰‹é‚£é‡Œåˆ†å¾— ${gift} é‡‘å¸`, "ğŸ’°");
            } else if (diff < -1000) {
                 let gift = Math.floor(-diff * 0.2);
                 p.money -= gift;
                 otherP.money += gift;
                 showInfo("ğŸ¹ ç½—å®¾æ±‰", `ä½ å¤ªå¯Œæœ‰äº†ï¼åˆ†ç»™å¯¹æ‰‹ ${gift} é‡‘å¸`, "ğŸ’¸");
            } else {
                showInfo("ğŸ¹ ç½—å®¾æ±‰", "ä½ ä»¬è´¢å¯Œç›¸å½“ï¼Œç½—å®¾æ±‰å»åˆ«å¤„äº†", "ğŸ‘‹");
            }
            updateUI();
        } else if(d.name === "ç¥ä»™æ•™æ¯") { // çº¯ç¦åˆ©
            let gift = 1000;
            p.money += gift;
            p.buff += 0.05; // å°buff
            showInfo("ğŸ§šâ€â™€ï¸ ç¥ä»™æ•™æ¯", `Bibbidi-Bobbidi-Boo! è·å¾— ${gift} é‡‘å¸å’Œä¸€ç‚¹ç‚¹å¥½è¿`, "âœ¨");
            updateUI();
        } else if(d.name === "ç–¯å¸½å­èŒ¶ä¼š") { // éšæœºäº‹ä»¶
            let r = Math.random();
            if(r < 0.33) {
                p.money += 800; showInfo("ğŸ© ç–¯å¸½å­", "éç”Ÿæ—¥å¿«ä¹ï¼è·å¾— 800", "ğŸ°");
            } else if(r < 0.66) {
                p.money -= 300; showInfo("ğŸ© ç–¯å¸½å­", "ä½ æ‰“ç¢äº†èŒ¶æ¯ï¼Œèµ”å¿ 300", "â˜•");
            } else {
                moveStep(p, 3); log("è¢«ç–¯ç‹‚çš„å…”å­å¸¦ç€è·‘äº†3æ ¼", "#e91e63"); return;
            }
            updateUI();
        } else if(d.name === "å›½ç‹çš„æ³•ä»¤") { // å®è§‚è°ƒæ§
            let events = [
                { t: "çš‡å®¶åº†å…¸", d: "å›½ç‹å¿ƒæƒ…å¥½ï¼Œå…¨å‘˜å¥–åŠ± 2000", f: (p)=> 2000 },
                { t: "å·¨é¾™æ¥è¢­", d: "éœ€è¦ä¿®è¡¥åŸå¢™ï¼Œå…¨å‘˜æ‰£é™¤ 1500", f: (p)=> -1500 },
                { t: "ä¸°æ”¶å­£èŠ‚", d: "åº„ç¨¼ä¸°æ”¶ï¼Œèµ„äº§å¢åŠ  10%", f: (p)=> Math.floor(p.money*0.1) },
                { t: "é­”æ³•é£æš´", d: "é­”æ³•å¤±æ§ï¼Œèµ„äº§å‡å°‘ 10%", f: (p)=> -Math.floor(p.money*0.1) }
            ];
            let ev = events[Math.floor(Math.random()*events.length)];
            players[0].money += ev.f(players[0]); players[1].money += ev.f(players[1]);
            updateUI(); log(`ğŸ“œ å›½ç‹æ³•ä»¤: ${ev.t}`, "#8e44ad"); showInfo("ğŸ“œ " + ev.t, ev.d, "ğŸ“¢");
        } else if(d.name === "ä»™å¥³è¯Šæ‰€") {
            let c=1000; p.money-=c; updateUI(); showInfo("ğŸ§šâ€â™€ï¸ ä»™å¥³è¯Šæ‰€", "é­”æ³•æ²»ç–—è´¹ "+c, "âœ¨");
        } else if(d.name === "åˆå¤œé’Ÿå£°") { // ç†”æ–­
            let c=Math.floor(p.money*0.05); p.money-=c; updateUI(); showInfo("ğŸ•› åˆå¤œé’Ÿå£°", "é­”æ³•æ¶ˆå¤±ï¼Œèµ„äº§ç¼©æ°´ "+c, "ğŸ“‰");
        } else if(d.name === "ä¹Œè‹æ‹‰å¥‘çº¦") { // ç¨åŠ¡
            let t=Math.floor(p.money*0.1); p.money-=t; updateUI(); showInfo("ğŸ™ ä¹Œè‹æ‹‰å¥‘çº¦", "äº¤å‡ºå£°éŸ³(é‡‘å¸) "+t, "ğŸ“œ");
        } else if(d.name === "æ€ªå…½å¤§å­¦") {
            p.money-=500; p.buff=0.15; updateUI(); document.getElementById(p.id===0?'p1-buff':'p2-buff').innerText="Buff: èƒœç‡+15%";
            showInfo("ğŸ« æ€ªå…½å¤§å­¦", "å­¦ä¹ æƒŠå“æŠ€å·§ï¼Œä¸‹æ¬¡èƒœç‡+15%", "ğŸ“š");
        } else {
            nextTurn();
        }
    }

    // --- é—®ç­” ---
    let currentQuizPlayer, currentQuestion;
    function openQuiz(p) {
        currentQuizPlayer = p;
        currentQuestion = quizBank[Math.floor(Math.random() * quizBank.length)];
        document.getElementById('quiz-q').innerText = currentQuestion.q;
        const optsDiv = document.getElementById('quiz-options');
        optsDiv.innerHTML = "";
        currentQuestion.opts.forEach((opt, idx) => {
            let btn = document.createElement('button');
            btn.className = "quiz-btn"; btn.innerText = ["A. ", "B. ", "C. "][idx] + opt;
            btn.onclick = () => checkQuiz(idx);
            optsDiv.appendChild(btn);
        });
        document.getElementById('quiz-feedback').innerHTML = "";
        document.getElementById('quiz-close-btn').style.display = 'none';
        document.getElementById('modal-quiz').style.display = 'flex';
    }
    function checkQuiz(ansIdx) {
        document.querySelectorAll('.quiz-btn').forEach(b => b.disabled = true);
        const feedback = document.getElementById('quiz-feedback');
        if(ansIdx === currentQuestion.ans) {
            currentQuizPlayer.money += 800;
            feedback.innerHTML = `<div class="quiz-result-good">âœ… ç­”å¯¹äº†ï¼å¥–åŠ± 800 é‡‘å¸</div><div style="font-size:13px;color:#666;margin-top:5px;">${currentQuestion.why}</div>`;
        } else {
            currentQuizPlayer.money -= 400;
            feedback.innerHTML = `<div class="quiz-result-bad">âŒ ç­”é”™äº†ï¼æ‰£é™¤ 400 é‡‘å¸</div><div style="font-size:13px;color:#666;margin-top:5px;">æ­£ç¡®ç­”æ¡ˆ: ${currentQuestion.opts[currentQuestion.ans]}<br>${currentQuestion.why}</div>`;
        }
        updateUI();
        document.getElementById('quiz-close-btn').style.display = 'block';
    }
    function closeQuizModal() { document.getElementById('modal-quiz').style.display = 'none'; nextTurn(); }

    // --- äº¤æ˜“ ---
    function openTradeModal(data, p) {
        currentTrade = { p: p, baseP: (Math.random()*(data.maxP-data.minP)+data.minP) };
        let finalP = currentTrade.baseP + p.buff;
        if(finalP > 0.95) finalP = 0.95;
        currentTrade.finalP = finalP;

        const modal = document.getElementById('modal-trade');
        document.getElementById('trade-title').innerText = `${data.icon} ${data.name}`;
        let pct = Math.round(finalP*100);
        document.getElementById('trade-prob').innerText = `${pct}%`;
        document.getElementById('prob-bar').style.width = `${pct}%`;
        document.getElementById('trade-prob').style.color = finalP < 0.5 ? '#e74c3c' : '#e67e22';

        const range = document.getElementById('invest-range');
        range.max = Math.floor(p.money); range.value = 0;
        updateRangeUI();
        document.getElementById('trade-input-ui').style.display = 'block';
        document.getElementById('trade-result').innerHTML = '';
        modal.style.display = 'flex';
    }

    function updateRangeUI() { 
        let val = document.getElementById('invest-range').value;
        let max = document.getElementById('invest-range').max;
        let pct = max > 0 ? Math.round((val / max) * 100) : 0;
        document.getElementById('invest-val').innerText = `${val} (${pct}%)`;
    }
    function setInvest(r) { document.getElementById('invest-range').value = Math.floor(currentTrade.p.money * r); updateRangeUI(); }

    function confirmTrade() {
        const bet = parseInt(document.getElementById('invest-range').value);
        const p = currentTrade.p;
        if(p.buff > 0) { p.buff = 0; document.getElementById(p.id===0?'p1-buff':'p2-buff').innerText = ""; }
        document.getElementById('trade-input-ui').style.display = 'none';

        const win = Math.random() <= currentTrade.finalP;
        let html = '';
        if(win) {
            p.money += bet;
            html = `<div class="trade-info" style="border:1px solid #66bb6a; background:#e8f5e9;"><b>âœ¨ æŠ•èµ„æˆåŠŸ</b><br>é‡‘å¸ +${bet}</div>`;
            log(`æŠ•èµ„ç›ˆåˆ© ${bet}`, 'green');
        } else {
            p.money -= bet;
            html = `<div class="trade-info" style="border:1px solid #ef5350; background:#ffebee;"><b>ğŸ¥€ æŠ•èµ„å¤±è´¥</b><br>é‡‘å¸ -${bet}</div>`;
            log(`æŠ•èµ„äºæŸ ${bet}`, 'red');
        }
        
        let k = (2 * currentTrade.finalP) - 1;
        let adviceText = k <= 0 ? "ä¸è¯¥æŠ•å…¥ï¼" : `å»ºè®®æŠ•å…¥: <b>${Math.round(k*100)}%</b>`;
        html += `<div style="font-size:12px;color:#888;margin-top:5px;">æ¢…æ—å…¬å¼å»ºè®®: ${adviceText}</div>`;
        html += `<button class="btn-main" onclick="closeTrade()" style="padding:8px; margin-top:10px;">ç»§ç»­</button>`;
        document.getElementById('trade-result').innerHTML = html;
        updateUI();
    }
    function closeTrade() { document.getElementById('modal-trade').style.display = 'none'; nextTurn(); }
    function showInfo(t, d, i) { document.getElementById('info-title').innerText=t; document.getElementById('info-desc').innerText=d; document.getElementById('info-icon').innerText=i; document.getElementById('modal-info').style.display='flex'; }
    function closeInfoModal() { document.getElementById('modal-info').style.display='none'; nextTurn(); }
    function updateUI() { document.getElementById('p1-money').innerText = Math.floor(players[0].money); document.getElementById('p2-money').innerText = Math.floor(players[1].money); updateStatus(); }
    function updateCenter(icon, title, desc) { document.getElementById('center-icon').innerText = icon; document.getElementById('center-title').innerText = title; document.getElementById('center-desc').innerText = desc; }
    function updateStatus() {
        if(gameMode === 1) {
            let p1Pct = Math.min(100, (players[0].money / targetMoney) * 100);
            let p2Pct = Math.min(100, (players[1].money / targetMoney) * 100);
            document.getElementById('p1-progress').style.width = p1Pct + "%"; document.getElementById('p2-progress').style.width = p2Pct + "%";
            document.getElementById('turn-text').innerText = "Round: " + roundCount;
        } else if(gameMode === 2) {
            let turnPct = Math.min(100, (roundCount / maxRounds) * 100);
            document.getElementById('p1-progress').style.width = turnPct + "%"; document.getElementById('p2-progress').style.width = turnPct + "%";
            document.getElementById('turn-text').innerText = `Round: ${roundCount} / ${maxRounds}`;
        }
    }
    function log(msg, color='#666') { let div = document.createElement('div'); div.innerHTML = msg; div.style.color = color; document.getElementById('log-box').prepend(div); }
    function nextTurn() {
        if (checkGameOver()) return;
        players[turn].card.classList.remove('active'); turn = (turn+1)%2;
        if(turn === 0) roundCount++;
        if (gameMode === 2 && roundCount > maxRounds) { triggerGameOver("å›åˆç»“æŸ"); return; }
        players[turn].card.classList.add('active'); isAnimating = false; document.getElementById('roll-btn').disabled = false;
        log(`ğŸ‘‰ è½®åˆ° ${players[turn].name}`, "#9b59b6"); updateStatus();
    }
    function checkGameOver() {
        if (players[turn].money <= 0) { triggerGameOver("é‡‘å¸è€—å°½"); return true; }
        if (gameMode === 1 && players[turn].money >= targetMoney) { triggerGameOver("è¾¾æˆè´¢å¯Œç›®æ ‡"); return true; }
        return false;
    }
    function triggerGameOver(reason) {
        document.getElementById('modal-end').style.display = 'flex'; document.getElementById('end-reason').innerText = `åŸå› : ${reason}`;
        document.getElementById('end-p1-money').innerText = Math.floor(players[0].money); document.getElementById('end-p2-money').innerText = Math.floor(players[1].money);
        let winnerName = players[0].money > players[1].money ? "ğŸ¤´ ç‹å­ è·èƒœ!" : (players[1].money > players[0].money ? "ğŸ‘¸ å…¬ä¸» è·èƒœ!" : "ğŸ¤ å¹³å±€!");
        document.getElementById('winner-name').innerText = "ğŸ‰ " + winnerName;
    }
    window.onload = function() { };
</script>
</body>
</html>